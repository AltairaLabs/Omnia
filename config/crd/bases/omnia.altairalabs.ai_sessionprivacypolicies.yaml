---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: sessionprivacypolicies.omnia.altairalabs.ai
spec:
  group: omnia.altairalabs.ai
  names:
    kind: SessionPrivacyPolicy
    listKind: SessionPrivacyPolicyList
    plural: sessionprivacypolicies
    singular: sessionprivacypolicy
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.level
      name: Level
      type: string
    - jsonPath: .spec.recording.enabled
      name: Recording
      type: boolean
    - jsonPath: .spec.recording.pii.redact
      name: PII Redact
      type: boolean
    - jsonPath: .spec.encryption.enabled
      name: Encryption
      type: boolean
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          SessionPrivacyPolicy is the Schema for the sessionprivacypolicies API.
          It defines privacy rules for session data including PII handling, encryption,
          retention overrides, user opt-out, and audit logging.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of SessionPrivacyPolicy
            properties:
              agentRef:
                description: |-
                  agentRef references the AgentRuntime this policy applies to.
                  Required when level is "agent".
                properties:
                  name:
                    description: name is the name of the object.
                    minLength: 1
                    type: string
                  namespace:
                    description: |-
                      namespace is the namespace of the object.
                      If not specified, defaults to the same namespace as the referencing object.
                    type: string
                required:
                - name
                type: object
              auditLog:
                description: auditLog configures audit logging for privacy-related
                  operations.
                properties:
                  enabled:
                    description: enabled specifies whether audit logging is active.
                    type: boolean
                  retentionDays:
                    description: retentionDays is the number of days to retain audit
                      log entries.
                    format: int32
                    minimum: 1
                    type: integer
                type: object
              encryption:
                description: encryption configures encryption for session data at
                  rest.
                properties:
                  enabled:
                    description: enabled specifies whether encryption is active.
                    type: boolean
                  kmsProvider:
                    description: |-
                      kmsProvider specifies the key management service to use.
                      Required when enabled is true.
                    enum:
                    - aws-kms
                    - azure-keyvault
                    - gcp-kms
                    - vault
                    type: string
                  secretRef:
                    description: secretRef references a Secret containing encryption
                      credentials.
                    properties:
                      name:
                        description: name is the name of the object.
                        minLength: 1
                        type: string
                    required:
                    - name
                    type: object
                type: object
                x-kubernetes-validations:
                - message: kmsProvider is required when encryption is enabled
                  rule: '!self.enabled || has(self.kmsProvider)'
              level:
                description: level defines the scope at which this policy applies.
                enum:
                - global
                - workspace
                - agent
                type: string
              recording:
                description: recording configures what session data is recorded.
                properties:
                  enabled:
                    description: enabled specifies whether session recording is active.
                    type: boolean
                  facadeData:
                    description: facadeData enables recording of facade-layer session
                      data (summaries, metadata).
                    type: boolean
                  pii:
                    description: pii configures PII handling within recorded session
                      data.
                    properties:
                      encrypt:
                        description: encrypt enables PII encryption instead of or
                          in addition to redaction.
                        type: boolean
                      patterns:
                        description: |-
                          patterns specifies which PII patterns to detect.
                          Built-in patterns: ssn, credit_card, phone_number, email, ip_address.
                          Custom regex patterns can be specified with the "custom:" prefix (e.g., "custom:^[A-Z]{2}\\d{6}$").
                        items:
                          type: string
                        type: array
                      redact:
                        description: redact enables automatic PII redaction in session
                          data.
                        type: boolean
                      strategy:
                        description: 'strategy specifies how PII is redacted. Options:
                          replace (default), hash, mask.'
                        enum:
                        - replace
                        - hash
                        - mask
                        type: string
                    type: object
                  richData:
                    description: richData enables recording of full session content
                      (messages, tool calls, artifacts).
                    type: boolean
                required:
                - enabled
                type: object
              retention:
                description: retention configures privacy-specific retention overrides.
                properties:
                  facade:
                    description: facade configures retention for facade-layer data.
                    properties:
                      coldDays:
                        description: coldDays is the number of days to retain data
                          in the cold archive.
                        format: int32
                        minimum: 0
                        type: integer
                      warmDays:
                        description: warmDays is the number of days to retain data
                          in the warm store.
                        format: int32
                        minimum: 0
                        type: integer
                    type: object
                  richData:
                    description: richData configures retention for full session content.
                    properties:
                      coldDays:
                        description: coldDays is the number of days to retain data
                          in the cold archive.
                        format: int32
                        minimum: 0
                        type: integer
                      warmDays:
                        description: warmDays is the number of days to retain data
                          in the warm store.
                        format: int32
                        minimum: 0
                        type: integer
                    type: object
                type: object
              userOptOut:
                description: userOptOut configures user opt-out and data deletion
                  capabilities.
                properties:
                  deleteWithinDays:
                    description: deleteWithinDays is the maximum number of days to
                      fulfill a deletion request.
                    format: int32
                    minimum: 1
                    type: integer
                  enabled:
                    description: enabled specifies whether users can opt out of session
                      recording.
                    type: boolean
                  honorDeleteRequests:
                    description: honorDeleteRequests specifies whether user data deletion
                      requests are honored.
                    type: boolean
                type: object
              workspaceRef:
                description: |-
                  workspaceRef references the Workspace this policy applies to.
                  Required when level is "workspace".
                properties:
                  name:
                    description: name is the name of the object.
                    minLength: 1
                    type: string
                required:
                - name
                type: object
            required:
            - level
            - recording
            type: object
            x-kubernetes-validations:
            - message: workspaceRef is required when level is 'workspace'
              rule: self.level != 'workspace' || has(self.workspaceRef)
            - message: agentRef is required when level is 'agent'
              rule: self.level != 'agent' || has(self.agentRef)
            - message: workspaceRef must not be set when level is 'global'
              rule: self.level != 'global' || !has(self.workspaceRef)
            - message: agentRef must not be set when level is 'global'
              rule: self.level != 'global' || !has(self.agentRef)
          status:
            description: status defines the observed state of SessionPrivacyPolicy
            properties:
              conditions:
                description: conditions represent the current state of the SessionPrivacyPolicy
                  resource.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              observedGeneration:
                description: observedGeneration is the most recent generation observed
                  by the controller.
                format: int64
                type: integer
              phase:
                description: phase represents the current lifecycle phase of the policy.
                enum:
                - Active
                - Error
                type: string
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
