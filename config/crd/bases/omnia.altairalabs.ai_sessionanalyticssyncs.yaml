---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: sessionanalyticssyncs.omnia.altairalabs.ai
spec:
  group: omnia.altairalabs.ai
  names:
    kind: SessionAnalyticsSync
    listKind: SessionAnalyticsSyncList
    plural: sessionanalyticssyncs
    singular: sessionanalyticssync
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.provider
      name: Provider
      type: string
    - jsonPath: .spec.sync.schedule
      name: Schedule
      type: string
    - jsonPath: .status.lastSyncStatus
      name: Last Sync Status
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          SessionAnalyticsSync is the Schema for the sessionanalyticssyncs API.
          It defines configuration for automatic sync of session data to analytics backends.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of SessionAnalyticsSync
            properties:
              bigquery:
                description: |-
                  bigquery defines the BigQuery backend configuration.
                  Required when provider is "bigquery".
                properties:
                  dataset:
                    description: dataset is the BigQuery dataset name.
                    minLength: 1
                    type: string
                  location:
                    default: US
                    description: location is the BigQuery dataset location (e.g.,
                      "US", "EU").
                    type: string
                  projectID:
                    description: projectID is the GCP project ID.
                    minLength: 1
                    type: string
                  secretRef:
                    description: secretRef references a Secret containing GCP credentials.
                    properties:
                      name:
                        default: ""
                        description: |-
                          Name of the referent.
                          This field is effectively required, but due to backwards compatibility is
                          allowed to be empty. Instances of this type with an empty value here are
                          almost certainly wrong.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                        type: string
                    type: object
                    x-kubernetes-map-type: atomic
                required:
                - dataset
                - projectID
                - secretRef
                type: object
              clickhouse:
                description: |-
                  clickhouse defines the ClickHouse backend configuration.
                  Required when provider is "clickhouse".
                properties:
                  auth:
                    description: auth defines the authentication configuration for
                      ClickHouse.
                    properties:
                      secretRef:
                        description: secretRef references a Secret containing ClickHouse
                          credentials.
                        properties:
                          name:
                            default: ""
                            description: |-
                              Name of the referent.
                              This field is effectively required, but due to backwards compatibility is
                              allowed to be empty. Instances of this type with an empty value here are
                              almost certainly wrong.
                              More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            type: string
                        type: object
                        x-kubernetes-map-type: atomic
                    required:
                    - secretRef
                    type: object
                  database:
                    description: database is the target ClickHouse database.
                    minLength: 1
                    type: string
                  hosts:
                    description: hosts is the list of ClickHouse host:port addresses.
                    items:
                      type: string
                    minItems: 1
                    type: array
                required:
                - auth
                - database
                - hosts
                type: object
              enabled:
                default: true
                description: enabled specifies whether the analytics sync is active.
                type: boolean
              provider:
                description: provider specifies the analytics backend to sync to.
                enum:
                - snowflake
                - bigquery
                - clickhouse
                type: string
              snowflake:
                description: |-
                  snowflake defines the Snowflake backend configuration.
                  Required when provider is "snowflake".
                properties:
                  account:
                    description: account is the Snowflake account identifier (e.g.,
                      "xy12345.us-east-1").
                    minLength: 1
                    type: string
                  database:
                    description: database is the target Snowflake database.
                    minLength: 1
                    type: string
                  role:
                    description: role is the Snowflake role to use for loading.
                    type: string
                  schema:
                    default: PUBLIC
                    description: schema is the target Snowflake schema.
                    type: string
                  secretRef:
                    description: secretRef references a Secret containing Snowflake
                      credentials.
                    properties:
                      name:
                        default: ""
                        description: |-
                          Name of the referent.
                          This field is effectively required, but due to backwards compatibility is
                          allowed to be empty. Instances of this type with an empty value here are
                          almost certainly wrong.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                        type: string
                    type: object
                    x-kubernetes-map-type: atomic
                  warehouse:
                    description: warehouse is the Snowflake warehouse to use for loading.
                    minLength: 1
                    type: string
                required:
                - account
                - database
                - secretRef
                - warehouse
                type: object
              source:
                description: source defines where to read session data from.
                properties:
                  type:
                    default: cold_archive
                    description: type specifies which storage tier to sync from.
                    enum:
                    - cold_archive
                    - warm_store
                    type: string
                type: object
              sync:
                description: sync defines the scheduling and behavior of sync operations.
                properties:
                  batchSize:
                    default: 10000
                    description: batchSize is the number of rows to process per batch.
                    format: int32
                    minimum: 1
                    type: integer
                  mode:
                    default: incremental
                    description: mode defines whether to run a full or incremental
                      sync.
                    enum:
                    - full
                    - incremental
                    type: string
                  parallelism:
                    default: 4
                    description: parallelism is the number of parallel sync workers.
                    format: int32
                    maximum: 32
                    minimum: 1
                    type: integer
                  schedule:
                    description: schedule is a cron expression for when to run the
                      sync.
                    minLength: 1
                    type: string
                required:
                - schedule
                type: object
              tables:
                description: tables defines the table mappings for sync.
                properties:
                  artifacts:
                    description: artifacts defines the mapping for the artifacts table.
                    properties:
                      partitionBy:
                        description: partitionBy is the column used for partitioning
                          in the target table.
                        type: string
                      target:
                        description: target is the name of the destination table in
                          the analytics backend.
                        minLength: 1
                        type: string
                    required:
                    - target
                    type: object
                  messages:
                    description: messages defines the mapping for the messages table.
                    properties:
                      partitionBy:
                        description: partitionBy is the column used for partitioning
                          in the target table.
                        type: string
                      target:
                        description: target is the name of the destination table in
                          the analytics backend.
                        minLength: 1
                        type: string
                    required:
                    - target
                    type: object
                  sessions:
                    description: sessions defines the mapping for the sessions table.
                    properties:
                      partitionBy:
                        description: partitionBy is the column used for partitioning
                          in the target table.
                        type: string
                      target:
                        description: target is the name of the destination table in
                          the analytics backend.
                        minLength: 1
                        type: string
                    required:
                    - target
                    type: object
                type: object
            required:
            - provider
            - sync
            type: object
            x-kubernetes-validations:
            - message: snowflake configuration is required when provider is snowflake
              rule: self.provider != 'snowflake' || has(self.snowflake)
            - message: bigquery configuration is required when provider is bigquery
              rule: self.provider != 'bigquery' || has(self.bigquery)
            - message: clickhouse configuration is required when provider is clickhouse
              rule: self.provider != 'clickhouse' || has(self.clickhouse)
          status:
            description: status defines the observed state of SessionAnalyticsSync
            properties:
              conditions:
                description: conditions represent the current state of the SessionAnalyticsSync
                  resource.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              errors:
                description: errors contains any errors from the last sync operation.
                items:
                  type: string
                type: array
              lastSyncAt:
                description: lastSyncAt is the timestamp of the last sync operation.
                format: date-time
                type: string
              lastSyncStatus:
                description: lastSyncStatus is the result of the last sync operation.
                enum:
                - Success
                - Failed
                - Running
                type: string
              nextSyncAt:
                description: nextSyncAt is the scheduled time for the next sync operation.
                format: date-time
                type: string
              observedGeneration:
                description: observedGeneration is the most recent generation observed
                  by the controller.
                format: int64
                type: integer
              phase:
                description: phase represents the current lifecycle phase of the sync
                  configuration.
                enum:
                - Active
                - Error
                - Syncing
                type: string
              rowsSynced:
                description: rowsSynced is the number of rows synced in the last operation.
                format: int64
                type: integer
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
