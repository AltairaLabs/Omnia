---
# Namespace for sample resources
apiVersion: v1
kind: Namespace
metadata:
  name: dev-agents
---
# Workspace CRD - maps to dev-agents namespace
# This makes the namespace visible in the dashboard
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Workspace
metadata:
  name: dev-agents
spec:
  displayName: Development Agents
  description: Development workspace for agent testing
  environment: development
  namespace:
    name: dev-agents
  # No roleBindings/directGrants - anonymous users get viewer access
---
# =============================================================================
# Credential Secrets for Providers
# These secrets are managed by the dashboard's Credentials Management UI
# Label: omnia.altairalabs.ai/type=credentials makes them visible in the UI
# =============================================================================

# Anthropic credentials (used by claude-provider)
apiVersion: v1
kind: Secret
metadata:
  name: anthropic-credentials
  namespace: dev-agents
  labels:
    omnia.altairalabs.ai/type: credentials
  annotations:
    omnia.altairalabs.ai/provider: claude
type: Opaque
stringData:
  ANTHROPIC_API_KEY: "sk-ant-demo-key-replace-with-real-key"
---
# OpenAI credentials (used by openai-provider)
apiVersion: v1
kind: Secret
metadata:
  name: openai-credentials
  namespace: dev-agents
  labels:
    omnia.altairalabs.ai/type: credentials
  annotations:
    omnia.altairalabs.ai/provider: openai
type: Opaque
stringData:
  OPENAI_API_KEY: "sk-demo-key-replace-with-real-key"
---
# =============================================================================
# Provider CRDs
# Reusable LLM provider configurations that reference credential secrets
# =============================================================================

# Claude provider using Anthropic credentials
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Provider
metadata:
  name: claude-provider
  namespace: dev-agents
spec:
  type: claude
  model: claude-sonnet-4-20250514
  secretRef:
    name: anthropic-credentials
  defaults:
    temperature: "0.7"
    maxTokens: 4096
  pricing:
    inputCostPer1K: "0.003"
    outputCostPer1K: "0.015"
---
# OpenAI provider using OpenAI credentials
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Provider
metadata:
  name: openai-provider
  namespace: dev-agents
spec:
  type: openai
  model: gpt-4o
  secretRef:
    name: openai-credentials
  defaults:
    temperature: "0.7"
    maxTokens: 4096
  pricing:
    inputCostPer1K: "0.005"
    outputCostPer1K: "0.015"
---
# Mock provider for testing (no credentials needed)
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Provider
metadata:
  name: mock-provider
  namespace: dev-agents
spec:
  type: mock
---
# Mock OpenAI provider for testing (no credentials needed)
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Provider
metadata:
  name: mock-openai-provider
  namespace: dev-agents
spec:
  type: mock
  model: gpt-4o-mock
---
# ConfigMap for PromptPack (must contain pack.json)
apiVersion: v1
kind: ConfigMap
metadata:
  name: demo-prompts
  namespace: dev-agents
data:
  pack.json: |
    {
      "$schema": "https://promptpack.org/schema/latest/promptpack.schema.json",
      "id": "demo-prompts",
      "name": "Demo Prompts",
      "version": "1.0.0",
      "template_engine": {
        "version": "v1",
        "syntax": "{{variable}}"
      },
      "prompts": {
        "default": {
          "id": "default",
          "name": "Default",
          "version": "1.0.0",
          "system_template": "You are a helpful AI assistant for demo purposes. Be concise and friendly in your responses.",
          "parameters": {
            "temperature": 0.7
          }
        }
      }
    }
---
# PromptPack
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: PromptPack
metadata:
  name: demo-prompts
  namespace: dev-agents
spec:
  source:
    type: configmap
    configMapRef:
      name: demo-prompts
  version: "1.0.0"
  rollout:
    type: immediate
---
# ToolRegistry with HTTP handlers
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: ToolRegistry
metadata:
  name: demo-tools
  namespace: dev-agents
spec:
  handlers:
  - name: weather
    type: http
    httpConfig:
      endpoint: "https://api.weather.example.com/v1/current"
      method: GET
    tool:
      name: get_weather
      description: Get current weather for a location
      inputSchema:
        type: object
        properties:
          location:
            type: string
            description: City name or coordinates
        required: [location]
    timeout: "10s"
  - name: calculator
    type: http
    httpConfig:
      endpoint: "https://api.calculator.example.com/v1/compute"
      method: POST
    tool:
      name: calculate
      description: Perform mathematical calculations
      inputSchema:
        type: object
        properties:
          expression:
            type: string
            description: Mathematical expression to evaluate
        required: [expression]
    timeout: "5s"
---
# =============================================================================
# AgentRuntime Examples
# Demonstrates different provider configurations
# =============================================================================

# Demo agent using Claude provider (references anthropic-credentials secret)
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: AgentRuntime
metadata:
  name: demo-agent
  namespace: dev-agents
spec:
  promptPackRef:
    name: demo-prompts
  toolRegistryRef:
    name: demo-tools
  providerRef:
    name: claude-provider
  facade:
    type: websocket
    port: 8080
    handler: demo
  session:
    type: memory
    ttl: "1h"
  runtime:
    replicas: 1
    resources:
      requests:
        cpu: "50m"
        memory: "64Mi"
      limits:
        cpu: "200m"
        memory: "128Mi"
---
# Runtime agent using mock provider (no credentials needed)
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: AgentRuntime
metadata:
  name: runtime-agent
  namespace: dev-agents
spec:
  promptPackRef:
    name: demo-prompts
  toolRegistryRef:
    name: demo-tools
  providerRef:
    name: mock-provider
  facade:
    type: websocket
    port: 8080
    handler: runtime
  session:
    type: memory
    ttl: "1h"
  runtime:
    replicas: 1
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "256Mi"
---
# Echo agent using mock OpenAI provider (no credentials needed)
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: AgentRuntime
metadata:
  name: echo-agent
  namespace: dev-agents
spec:
  promptPackRef:
    name: demo-prompts
  providerRef:
    name: mock-openai-provider
  facade:
    type: websocket
    port: 8080
    handler: echo
  session:
    type: memory
    ttl: "30m"
  runtime:
    replicas: 1
    resources:
      requests:
        cpu: "25m"
        memory: "32Mi"
      limits:
        cpu: "100m"
        memory: "64Mi"
