---
# Namespace for sample resources
apiVersion: v1
kind: Namespace
metadata:
  name: dev-agents
---
# Workspace CRD - maps to dev-agents namespace
# This makes the namespace visible in the dashboard
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Workspace
metadata:
  name: dev-agents
spec:
  displayName: Development Agents
  description: Development workspace for agent testing
  environment: development
  namespace:
    name: dev-agents
  # Enable anonymous access with editor role for development
  # WARNING: Only use viewer/none in production. editor/owner grants write access.
  # Editor role allows creating agents, dev sessions, arena jobs, etc.
  anonymousAccess:
    enabled: true
    role: editor
---
# =============================================================================
# Credential Secrets for Providers
# These secrets are managed by the dashboard's Credentials Management UI
# Label: omnia.altairalabs.ai/type=credentials makes them visible in the UI
# =============================================================================

# Anthropic credentials (used by claude-provider)
apiVersion: v1
kind: Secret
metadata:
  name: anthropic-credentials
  namespace: dev-agents
  labels:
    omnia.altairalabs.ai/type: credentials
  annotations:
    omnia.altairalabs.ai/provider: claude
type: Opaque
stringData:
  ANTHROPIC_API_KEY: "sk-ant-demo-key-replace-with-real-key"
---
# OpenAI credentials (used by openai-provider)
apiVersion: v1
kind: Secret
metadata:
  name: openai-credentials
  namespace: dev-agents
  labels:
    omnia.altairalabs.ai/type: credentials
  annotations:
    omnia.altairalabs.ai/provider: openai
type: Opaque
stringData:
  OPENAI_API_KEY: "sk-demo-key-replace-with-real-key"
---
# =============================================================================
# Provider CRDs
# Reusable LLM provider configurations that reference credential secrets
# =============================================================================

# Claude provider using Anthropic credentials
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Provider
metadata:
  name: claude-provider
  namespace: dev-agents
spec:
  type: claude
  model: claude-sonnet-4-20250514
  secretRef:
    name: anthropic-credentials
  defaults:
    temperature: "0.7"
    maxTokens: 4096
  pricing:
    inputCostPer1K: "0.003"
    outputCostPer1K: "0.015"
---
# OpenAI provider using OpenAI credentials
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Provider
metadata:
  name: openai-provider
  namespace: dev-agents
spec:
  type: openai
  model: gpt-4o
  secretRef:
    name: openai-credentials
  defaults:
    temperature: "0.7"
    maxTokens: 4096
  pricing:
    inputCostPer1K: "0.005"
    outputCostPer1K: "0.015"
---
# Mock provider for testing (no credentials needed)
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Provider
metadata:
  name: mock-provider
  namespace: dev-agents
spec:
  type: mock
---
# Mock OpenAI provider for testing (no credentials needed)
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Provider
metadata:
  name: mock-openai-provider
  namespace: dev-agents
spec:
  type: mock
  model: gpt-4o-mock
---
# ConfigMap for PromptPack (must contain pack.json)
apiVersion: v1
kind: ConfigMap
metadata:
  name: demo-prompts
  namespace: dev-agents
data:
  pack.json: |
    {
      "$schema": "https://promptpack.org/schema/latest/promptpack.schema.json",
      "id": "demo-prompts",
      "name": "Demo Prompts",
      "version": "2.0.0",
      "description": "Demo pack showcasing evals, validators, tools, and workflow features.",
      "template_engine": {
        "version": "v1",
        "syntax": "{{variable}}",
        "features": ["basic_substitution"]
      },
      "prompts": {
        "default": {
          "id": "default",
          "name": "General Assistant",
          "description": "Friendly general-purpose assistant with tool access.",
          "version": "2.0.0",
          "system_template": "You are a helpful AI assistant for demo purposes. Be concise and friendly in your responses. You can use tools to look up weather and perform calculations.",
          "tools": ["get_weather", "calculate"],
          "tool_policy": {
            "tool_choice": "auto",
            "max_rounds": 3
          },
          "parameters": {
            "temperature": 0.7,
            "max_tokens": 1024
          },
          "validators": [
            {
              "type": "max_length",
              "enabled": true,
              "fail_on_violation": false,
              "params": {
                "max_characters": 2000
              }
            }
          ],
          "evals": [
            {
              "id": "helpfulness",
              "type": "llm_judge",
              "trigger": "sample_turns",
              "sample_percentage": 20,
              "description": "Assess response helpfulness",
              "params": {
                "judge_prompt": "Rate the response for helpfulness and accuracy on a 1-5 scale.",
                "passing_score": 3
              },
              "metric": {
                "name": "helpfulness_score",
                "type": "gauge",
                "range": { "min": 0, "max": 1 }
              }
            },
            {
              "id": "contains-mock",
              "type": "contains",
              "trigger": "every_turn",
              "description": "Verify response contains expected content",
              "params": {
                "patterns": ["response"]
              },
              "metric": {
                "name": "response_contains_expected",
                "type": "boolean"
              }
            }
          ]
        }
      },
      "tools": {
        "get_weather": {
          "name": "get_weather",
          "description": "Get current weather for a location",
          "parameters": {
            "type": "object",
            "properties": {
              "location": {
                "type": "string",
                "description": "City name or coordinates"
              }
            },
            "required": ["location"]
          }
        },
        "calculate": {
          "name": "calculate",
          "description": "Perform mathematical calculations",
          "parameters": {
            "type": "object",
            "properties": {
              "expression": {
                "type": "string",
                "description": "Mathematical expression to evaluate"
              }
            },
            "required": ["expression"]
          }
        }
      },
      "evals": [
        {
          "id": "no-hallucination-urls",
          "type": "regex",
          "trigger": "every_turn",
          "description": "Flag responses that fabricate URLs",
          "params": {
            "pattern": "https?://[a-zA-Z0-9.-]+\\.[a-z]{2,}",
            "expect_match": false
          },
          "metric": {
            "name": "no_hallucinated_urls",
            "type": "boolean"
          }
        }
      ],
      "skills": [
        {
          "name": "demo-guidelines",
          "description": "Guidelines for demo conversations",
          "instructions": "This is a demo environment. Keep responses brief and showcase tool usage when relevant. Avoid making real API calls or referencing production systems."
        }
      ],
      "metadata": {
        "domain": "demo",
        "language": "en",
        "tags": ["demo", "general", "tools"]
      }
    }
---
# PromptPack
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: PromptPack
metadata:
  name: demo-prompts
  namespace: dev-agents
spec:
  source:
    type: configmap
    configMapRef:
      name: demo-prompts
  version: "2.0.0"
  rollout:
    type: immediate
---
# ToolRegistry with HTTP handlers
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: ToolRegistry
metadata:
  name: demo-tools
  namespace: dev-agents
spec:
  handlers:
  - name: weather
    type: http
    httpConfig:
      endpoint: "https://api.weather.example.com/v1/current"
      method: GET
    tool:
      name: get_weather
      description: Get current weather for a location
      inputSchema:
        type: object
        properties:
          location:
            type: string
            description: City name or coordinates
        required: [location]
    timeout: "10s"
  - name: calculator
    type: http
    httpConfig:
      endpoint: "https://api.calculator.example.com/v1/compute"
      method: POST
    tool:
      name: calculate
      description: Perform mathematical calculations
      inputSchema:
        type: object
        properties:
          expression:
            type: string
            description: Mathematical expression to evaluate
        required: [expression]
    timeout: "5s"
---
# =============================================================================
# AgentRuntime Examples
# Demonstrates different provider configurations
# =============================================================================

# Demo agent using Claude provider (references anthropic-credentials secret)
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: AgentRuntime
metadata:
  name: demo-agent
  namespace: dev-agents
spec:
  promptPackRef:
    name: demo-prompts
  toolRegistryRef:
    name: demo-tools
  providerRef:
    name: claude-provider
  facade:
    type: websocket
    port: 8080
    handler: demo
    extraEnv:
      - name: LOG_LEVEL
        value: debug
  session:
    type: memory
    ttl: "1h"
  runtime:
    replicas: 1
    extraEnv:
      - name: LOG_LEVEL
        value: debug
    resources:
      requests:
        cpu: "50m"
        memory: "64Mi"
      limits:
        cpu: "200m"
        memory: "128Mi"
---
# Runtime agent using mock provider (no credentials needed)
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: AgentRuntime
metadata:
  name: runtime-agent
  namespace: dev-agents
spec:
  promptPackRef:
    name: demo-prompts
  toolRegistryRef:
    name: demo-tools
  providerRef:
    name: mock-provider
  facade:
    type: websocket
    port: 8080
    handler: runtime
    extraEnv:
      - name: LOG_LEVEL
        value: debug
  session:
    type: memory
    ttl: "1h"
  runtime:
    replicas: 1
    extraEnv:
      - name: LOG_LEVEL
        value: debug
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "256Mi"
---
# Echo agent using mock OpenAI provider (no credentials needed)
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: AgentRuntime
metadata:
  name: echo-agent
  namespace: dev-agents
spec:
  promptPackRef:
    name: demo-prompts
  providerRef:
    name: mock-openai-provider
  facade:
    type: websocket
    port: 8080
    handler: echo
    extraEnv:
      - name: LOG_LEVEL
        value: debug
  session:
    type: memory
    ttl: "30m"
  runtime:
    replicas: 1
    extraEnv:
      - name: LOG_LEVEL
        value: debug
    resources:
      requests:
        cpu: "25m"
        memory: "32Mi"
      limits:
        cpu: "100m"
        memory: "64Mi"
