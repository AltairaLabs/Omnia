apiVersion: omnia.altairalabs.ai/v1alpha1
kind: AgentRuntime
metadata:
  labels:
    app.kubernetes.io/name: omnia
    app.kubernetes.io/managed-by: kustomize
  name: customer-support-agent
spec:
  # Reference to the PromptPack containing agent prompts
  promptPackRef:
    name: customer-support
    track: stable
  # WebSocket facade for client connections
  facade:
    type: websocket
    port: 8080
  # Optional tool registry reference
  toolRegistryRef:
    name: support-tools
  # Session configuration using Redis
  session:
    type: redis
    storeRef:
      name: redis-credentials
    ttl: "24h"
  # Deployment configuration
  runtime:
    replicas: 2
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"
  # Option 1: Reference a Provider CRD (recommended for shared configurations)
  providerRef:
    name: claude-sonnet
    namespace: omnia-system
  # Option 2: Inline provider config (uncomment to use instead of providerRef)
  # provider:
  #   type: openai
  #   model: gpt-4o
  #   secretRef:
  #     name: openai-credentials
  #   config:
  #     temperature: "0.7"
---
# Secret containing Redis connection URL
apiVersion: v1
kind: Secret
metadata:
  name: redis-credentials
type: Opaque
stringData:
  url: "redis://redis.cache.svc.cluster.local:6379"
