---
import { getCollection } from 'astro:content';
import DocsLayout from '../../layouts/DocsLayout.astro';
import Sidebar from '../../components/Sidebar.astro';

const explanations = await getCollection('explanation');
explanations.sort((a, b) => (a.data.order ?? 99) - (b.data.order ?? 99));

const joinPath = (path: string) => {
  const base = import.meta.env.BASE_URL;
  if (base === '/') return path.startsWith('/') ? path : `/${path}`;
  const cleanBase = base.endsWith('/') ? base.slice(0, -1) : base;
  const cleanPath = path.startsWith('/') ? path : `/${path}`;
  return `${cleanBase}${cleanPath}`;
};
---

<DocsLayout title="Concepts" description="Understanding how Omnia works" section="explanation">
  <Sidebar slot="sidebar" section="explanation" currentPath={Astro.url.pathname} />

  <h1>Concepts</h1>

  <p>
    Explanation documentation is <strong>understanding-oriented</strong> discussion that clarifies
    and illuminates a topic. It provides background and context to help you understand Omnia.
  </p>

  <hr />

  {explanations.length > 0 ? (
    <ul>
      {explanations.map(exp => (
        <li>
          <a href={joinPath(`/explanation/${exp.slug}/`)}>
            <strong>{exp.data.title}</strong>
          </a>
          {exp.data.description && (
            <p style="margin: 0.25rem 0 0.5rem 0; font-size: 0.875rem; color: #57606a;">
              {exp.data.description}
            </p>
          )}
        </li>
      ))}
    </ul>
  ) : (
    <p>No concept explanations available yet. Check back soon!</p>
  )}
</DocsLayout>
