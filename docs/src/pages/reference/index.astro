---
import { getCollection } from 'astro:content';
import DocsLayout from '../../layouts/DocsLayout.astro';
import Sidebar from '../../components/Sidebar.astro';

const references = await getCollection('reference');
references.sort((a, b) => (a.data.order ?? 99) - (b.data.order ?? 99));

const joinPath = (path: string) => {
  const base = import.meta.env.BASE_URL;
  if (base === '/') return path.startsWith('/') ? path : `/${path}`;
  const cleanBase = base.endsWith('/') ? base.slice(0, -1) : base;
  const cleanPath = path.startsWith('/') ? path : `/${path}`;
  return `${cleanBase}${cleanPath}`;
};
---

<DocsLayout title="Reference" description="Technical reference documentation" section="reference">
  <Sidebar slot="sidebar" section="reference" currentPath={Astro.url.pathname} />

  <h1>Reference</h1>

  <p>
    Reference guides are <strong>information-oriented</strong> technical descriptions of the
    machinery and how to operate it. They describe the system as accurately as possible.
  </p>

  <hr />

  {references.length > 0 ? (
    <ul>
      {references.map(ref => (
        <li>
          <a href={joinPath(`/reference/${ref.slug}/`)}>
            <strong>{ref.data.title}</strong>
          </a>
          {ref.data.description && (
            <p style="margin: 0.25rem 0 0.5rem 0; font-size: 0.875rem; color: #57606a;">
              {ref.data.description}
            </p>
          )}
        </li>
      ))}
    </ul>
  ) : (
    <p>No reference documentation available yet. Check back soon!</p>
  )}
</DocsLayout>
