# Omnia Demos Helm Chart Values
# This chart deploys demo agents showcasing vision, audio, and tool capabilities

# -- Namespace for demo resources
namespace: omnia-demo

# -- Workspace configuration
workspace:
  # -- Anonymous access configuration
  # Controls what access unauthenticated users have to this workspace
  anonymousAccess:
    # -- Enable anonymous access to this workspace
    # If false, anonymous users cannot access resources in this workspace
    enabled: false
    # -- Role granted to anonymous users: viewer, editor, or owner
    # WARNING: editor/owner grants write access - only use in dev environments
    role: viewer

# Ollama configuration (local LLM server)
ollama:
  # -- Ollama image
  image:
    repository: ollama/ollama
    tag: latest
    pullPolicy: IfNotPresent
  # -- Model to pre-pull (llava for vision capabilities)
  model: llava:7b
  # -- Additional models to pre-pull (e.g., for tool use)
  additionalModels:
    - llama3.2:3b
  # -- Keep model loaded in memory
  keepAlive: "24h"
  # -- Context window size (number of tokens) for Ollama server.
  # This is the Ollama-side limit. Default is 2048.
  numCtx: 8192
  # -- Context window budget for PromptKit truncation.
  # Should be <= numCtx. When conversation exceeds this, older messages are truncated.
  contextWindow: 8192
  # -- Resource requirements
  # llava:7b requires ~4GB RAM minimum, 8GB recommended
  resources:
    requests:
      memory: "4Gi"
      cpu: "2"
    limits:
      memory: "16Gi"
      cpu: "8"
  # -- Persistence for model cache (models are 4-8GB)
  persistence:
    enabled: true
    size: 20Gi
    storageClass: ""

# Vision demo agent configuration (uses Ollama/llava)
agent:
  # -- Agent name
  name: vision-demo
  # -- Facade handler type
  handler: runtime
  # -- Number of replicas
  replicas: 1
  # -- Resource requirements
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "256Mi"
  # -- Console configuration for file uploads
  console:
    # -- Maximum file size in bytes (8MB leaves room for base64 overhead)
    maxFileSize: 8388608
    # -- Maximum number of files per message
    maxFiles: 3
    # -- Allowed attachment MIME types
    allowedAttachmentTypes:
      - "image/png"
      - "image/jpeg"
      - "image/webp"
      - "image/gif"
    # -- Media requirements for the vision model
    mediaRequirements:
      image:
        # -- Maximum dimensions (llava:7b supports up to 1344x1344)
        maxWidth: 1344
        maxHeight: 1344
        # -- Recommended dimensions for optimal quality
        recommendedWidth: 672
        recommendedHeight: 672
        # -- Maximum image size in bytes
        maxSizeBytes: 8388608
        # -- Preferred output format
        preferredFormat: "image/jpeg"
        # -- Compression guidance
        compressionGuidance: "lossy-medium"

# Demo PromptPack configuration
promptPack:
  # -- System prompt for the vision demo agent
  systemPrompt: |
    You are a helpful vision-capable AI assistant powered by Ollama.
    You can analyze images and answer questions about them.
    Be concise, friendly, and helpful in your responses.

    When analyzing images:
    - Describe what you see clearly and objectively
    - Point out notable details or interesting elements
    - Answer any specific questions about the image content

# ============================================================================
# Audio Demo Agent (Gemini)
# Demonstrates audio capabilities using Google Gemini
# ============================================================================

audioDemo:
  # -- Enable audio demo agent (requires Gemini API key)
  enabled: false

  # -- Gemini provider configuration
  gemini:
    # -- Gemini model to use (gemini-2.5-flash has audio support)
    model: gemini-2.5-flash
    # -- Gemini API base URL (SDK multimodal path appends /models/<model>)
    # NOTE: Include /v1beta because PromptKit's multimodal path is missing it
    baseURL: https://generativelanguage.googleapis.com/v1beta
    # -- Name of the Kubernetes Secret containing the API key
    # Secret must have a key named 'api-key' with your GEMINI_API_KEY
    # Create with: kubectl create secret generic gemini-credentials -n omnia-demo --from-literal=api-key=YOUR_API_KEY
    secretName: gemini-credentials
    # -- Temperature for generation
    temperature: 0.7
    # -- Pricing per 1K tokens (for cost tracking)
    pricing:
      inputCostPer1K: "0.000075"
      outputCostPer1K: "0.0003"
      cachedCostPer1K: "0.0000375"

  # -- Agent configuration
  agent:
    # -- Agent name
    name: audio-demo
    # -- Facade handler type
    handler: runtime
    # -- Number of replicas
    replicas: 1
    # -- Log level for debugging (info, debug, warn, error)
    logLevel: debug
    # -- Resource requirements
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "256Mi"

  # -- Console configuration for audio uploads
  console:
    # -- Maximum file size in bytes (8MB for audio)
    maxFileSize: 8388608
    # -- Maximum number of files per message
    maxFiles: 3
    # -- Allowed attachment MIME types
    allowedAttachmentTypes:
      - "audio/mpeg"
      - "audio/wav"
      - "audio/ogg"
      - "audio/flac"
      - "audio/aac"
      - "audio/x-m4a"
      - "image/png"
      - "image/jpeg"
      - "image/webp"
    # -- Media requirements for Gemini audio
    mediaRequirements:
      audio:
        # -- Maximum duration in seconds (9.5 hours for Gemini)
        maxDurationSeconds: 34200
        # -- Recommended sample rate in Hz
        recommendedSampleRate: 16000
        # -- Supports selecting audio segments
        supportsSegmentSelection: true
      image:
        # -- Maximum dimensions for images
        maxWidth: 3072
        maxHeight: 3072
        # -- Recommended dimensions
        recommendedWidth: 1024
        recommendedHeight: 1024
        # -- Maximum image size
        maxSizeBytes: 8388608
        # -- Preferred format
        preferredFormat: "image/jpeg"
        # -- Compression guidance
        compressionGuidance: "lossy-medium"

  # -- PromptPack configuration
  promptPack:
    # -- System prompt for the audio demo agent
    systemPrompt: |
      You are a helpful AI assistant powered by Google Gemini with advanced audio understanding capabilities.
      You can analyze audio files and answer questions about them.
      Be concise, friendly, and helpful in your responses.

      When analyzing audio:
      - Describe what you hear clearly and objectively
      - If it's speech, provide accurate transcription when asked
      - Identify music, sounds, or other audio content
      - Answer any specific questions about the audio content
      - If the audio quality is poor, mention it and do your best

# ============================================================================
# Tools Demo Agent (llama3.2 with tool calling)
# Demonstrates tool/function calling capabilities
# ============================================================================

toolsDemo:
  # -- Enable tools demo agent
  enabled: true

  # -- Agent configuration
  agent:
    # -- Agent name
    name: tools-demo
    # -- Facade handler type
    handler: runtime
    # -- Number of replicas
    replicas: 1
    # -- Resource requirements
    resources:
      requests:
        cpu: "100m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "256Mi"

  # -- PromptPack configuration
  promptPack:
    # -- System prompt for the tools demo agent
    systemPrompt: |
      You are a helpful AI assistant with access to tools.
      Use the available tools when they can help answer the user's question.
      Always explain what you're doing when using tools.
      Be concise and helpful in your responses.

# ============================================================================
# OPA Policy Agent for model validation
# Prevents model switching when multiple agents share an Ollama instance
# ============================================================================

opa:
  # -- Enable OPA model validation
  enabled: false
  # -- Mode: "sidecar" (OPA+Envoy sidecars, no Istio) or "extauthz" (Istio ext_authz)
  mode: sidecar
  # -- Maximum request body size in bytes (default 25MB for multimodal/vision requests)
  maxRequestBytes: 26214400
  # -- OPA image (use envoy variant for sidecar mode)
  image:
    repository: openpolicyagent/opa
    tag: "0.68.0-envoy"
    pullPolicy: IfNotPresent
  # -- Resource requirements for OPA container
  resources:
    requests:
      cpu: "50m"
      memory: "64Mi"
    limits:
      cpu: "200m"
      memory: "128Mi"
  # -- Envoy proxy image (for sidecar mode)
  envoy:
    image:
      repository: envoyproxy/envoy
      tag: "v1.31-latest"
      pullPolicy: IfNotPresent
    resources:
      requests:
        cpu: "50m"
        memory: "64Mi"
      limits:
        cpu: "200m"
        memory: "128Mi"
  # -- Istio ext_authz mode settings (only used when mode=extauthz)
  extauthz:
    # -- gRPC port for ext_authz service
    port: 9191
    # -- Timeout for authorization decisions
    timeout: 5s
    # -- Failure mode: "DENY" or "ALLOW" (when OPA unavailable)
    failureMode: DENY

# ============================================================================
# Istio integration (for ext_authz mode)
# ============================================================================

istio:
  # -- Enable Istio integration (required for OPA extauthz mode)
  enabled: false

# ============================================================================
# Arena Demo - Prompt evaluation demonstration
# Shows how to run LLM evaluations against test scenarios
# ============================================================================

arenaDemo:
  # -- Enable arena demo
  enabled: false

  # -- ArenaSource configuration
  source:
    # -- Name of the ArenaSource
    name: demo-arena-source
    # -- Sync interval
    interval: 5m

  # -- ArenaConfig configuration
  config:
    # -- Name of the ArenaConfig
    name: demo-arena-config
    # -- Evaluation settings
    evaluation:
      timeout: "2m"
      maxRetries: 2
      concurrency: 1

  # -- ArenaJob configuration
  job:
    # -- Name of the ArenaJob
    name: demo-arena-job
    # -- Worker configuration
    workers:
      replicas: 1
    # -- TTL after job completion (1 hour)
    ttlSecondsAfterFinished: 3600
