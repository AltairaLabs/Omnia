---
# Dummy secret for Ollama (Ollama doesn't require an API key)
apiVersion: v1
kind: Secret
metadata:
  name: ollama-credentials
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-demos
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
type: Opaque
stringData:
  # Ollama doesn't require an API key, but Provider requires a secretRef
  api-key: "ollama-local"
---
# Provider configuration for Ollama
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Provider
metadata:
  name: ollama
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-demos
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
spec:
  type: ollama
  model: {{ .Values.ollama.model }}
  baseURL: http://ollama.{{ .Values.namespace }}:11434
  secretRef:
    name: ollama-credentials
  defaults:
    temperature: "0.7"
    # Context window budget - should match or be less than numCtx
    contextWindow: {{ .Values.ollama.contextWindow }}
    truncationStrategy: sliding
---
# ConfigMap for the demo PromptPack (vision-capable)
apiVersion: v1
kind: ConfigMap
metadata:
  name: demo-vision-prompts
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-demos
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
data:
  pack.json: |
    {
      "$schema": "https://promptpack.org/schema/latest/promptpack.schema.json",
      "id": "demo-vision-prompts",
      "name": "Demo Vision Prompts",
      "version": "1.0.0",
      "template_engine": {
        "version": "v1",
        "syntax": "{{"{{variable}}"}}"
      },
      "prompts": {
        "default": {
          "id": "default",
          "name": "Vision Assistant",
          "version": "1.0.0",
          "system_template": {{ .Values.promptPack.systemPrompt | toJson }},
          "parameters": {
            "temperature": 0.7
          }
        }
      }
    }
---
# PromptPack for the demo agent
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: PromptPack
metadata:
  name: demo-vision-prompts
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-demos
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
spec:
  source:
    type: configmap
    configMapRef:
      name: demo-vision-prompts
  version: "1.0.0"
  rollout:
    type: immediate
---
# Demo AgentRuntime using Ollama with vision capabilities
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: AgentRuntime
metadata:
  name: {{ .Values.agent.name }}
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-demos
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
    omnia.altairalabs.ai/workspace: demo
spec:
  promptPackRef:
    name: demo-vision-prompts
  providerRef:
    name: ollama
  facade:
    type: websocket
    port: 8080
    handler: {{ .Values.agent.handler }}
  session:
    type: memory
    ttl: "1h"
  runtime:
    replicas: {{ .Values.agent.replicas }}
    resources:
      {{- toYaml .Values.agent.resources | nindent 6 }}
  {{- with .Values.agent.console }}
  console:
    maxFileSize: {{ .maxFileSize | int64 }}
    maxFiles: {{ .maxFiles }}
    allowedAttachmentTypes:
      {{- toYaml .allowedAttachmentTypes | nindent 6 }}
    {{- with .mediaRequirements }}
    mediaRequirements:
      image:
        maxDimensions:
          width: {{ .image.maxWidth }}
          height: {{ .image.maxHeight }}
        recommendedDimensions:
          width: {{ .image.recommendedWidth }}
          height: {{ .image.recommendedHeight }}
        maxSizeBytes: {{ .image.maxSizeBytes | int64 }}
        preferredFormat: {{ .image.preferredFormat | quote }}
        compressionGuidance: {{ .image.compressionGuidance | quote }}
    {{- end }}
  {{- end }}
{{- /* ============================================================================ */ -}}
{{- /* Audio Demo Resources (Gemini-based) */ -}}
{{- /* ============================================================================ */ -}}
{{- if .Values.audioDemo.enabled }}
---
# Provider configuration for Gemini
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Provider
metadata:
  name: gemini
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-audio-demo
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
spec:
  type: gemini
  model: {{ .Values.audioDemo.gemini.model }}
  baseURL: {{ .Values.audioDemo.gemini.baseURL }}
  secretRef:
    name: {{ .Values.audioDemo.gemini.secretName }}
  defaults:
    temperature: {{ .Values.audioDemo.gemini.temperature | quote }}
  pricing:
    inputCostPer1K: {{ .Values.audioDemo.gemini.pricing.inputCostPer1K | quote }}
    outputCostPer1K: {{ .Values.audioDemo.gemini.pricing.outputCostPer1K | quote }}
    cachedCostPer1K: {{ .Values.audioDemo.gemini.pricing.cachedCostPer1K | quote }}
---
# ConfigMap for the audio demo PromptPack
apiVersion: v1
kind: ConfigMap
metadata:
  name: demo-audio-prompts
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-audio-demo
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
data:
  pack.json: |
    {
      "$schema": "https://promptpack.org/schema/latest/promptpack.schema.json",
      "id": "demo-audio-prompts",
      "name": "Demo Audio Prompts",
      "version": "1.0.0",
      "template_engine": {
        "version": "v1",
        "syntax": "{{"{{variable}}"}}"
      },
      "prompts": {
        "default": {
          "id": "default",
          "name": "Audio Assistant",
          "version": "1.0.0",
          "system_template": {{ .Values.audioDemo.promptPack.systemPrompt | toJson }},
          "parameters": {
            "temperature": {{ .Values.audioDemo.gemini.temperature }}
          }
        }
      }
    }
---
# PromptPack for the audio demo agent
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: PromptPack
metadata:
  name: demo-audio-prompts
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-audio-demo
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
spec:
  source:
    type: configmap
    configMapRef:
      name: demo-audio-prompts
  version: "1.0.0"
  rollout:
    type: immediate
---
# Audio Demo AgentRuntime using Gemini with audio capabilities
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: AgentRuntime
metadata:
  name: {{ .Values.audioDemo.agent.name }}
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-audio-demo
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
    omnia.altairalabs.ai/workspace: demo
spec:
  promptPackRef:
    name: demo-audio-prompts
  providerRef:
    name: gemini
  facade:
    type: websocket
    port: 8080
    handler: {{ .Values.audioDemo.agent.handler }}
  session:
    type: memory
    ttl: "1h"
  runtime:
    replicas: {{ .Values.audioDemo.agent.replicas }}
    resources:
      {{- toYaml .Values.audioDemo.agent.resources | nindent 6 }}
    {{- if .Values.audioDemo.agent.logLevel }}
    extraEnv:
      - name: LOG_LEVEL
        value: {{ .Values.audioDemo.agent.logLevel | quote }}
    {{- end }}
  {{- with .Values.audioDemo.console }}
  console:
    maxFileSize: {{ .maxFileSize | int64 }}
    maxFiles: {{ .maxFiles }}
    allowedAttachmentTypes:
      {{- toYaml .allowedAttachmentTypes | nindent 6 }}
    {{- with .mediaRequirements }}
    mediaRequirements:
      {{- with .audio }}
      audio:
        maxDurationSeconds: {{ .maxDurationSeconds }}
        recommendedSampleRate: {{ .recommendedSampleRate }}
        supportsSegmentSelection: {{ .supportsSegmentSelection }}
      {{- end }}
      {{- with .image }}
      image:
        maxDimensions:
          width: {{ .maxWidth }}
          height: {{ .maxHeight }}
        recommendedDimensions:
          width: {{ .recommendedWidth }}
          height: {{ .recommendedHeight }}
        maxSizeBytes: {{ .maxSizeBytes | int64 }}
        preferredFormat: {{ .preferredFormat | quote }}
        compressionGuidance: {{ .compressionGuidance | quote }}
      {{- end }}
    {{- end }}
  {{- end }}
{{- end }}
{{- /* ============================================================================ */ -}}
{{- /* Tools Demo Resources (llama3.2 with tool calling) */ -}}
{{- /* ============================================================================ */ -}}
{{- if .Values.toolsDemo.enabled }}
---
# Provider configuration for llama3.2 (tool-capable)
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: Provider
metadata:
  name: ollama-tools
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-tools-demo
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
spec:
  type: ollama
  model: llama3.2:3b
  baseURL: http://ollama.{{ .Values.namespace }}:11434
  secretRef:
    name: ollama-credentials
  defaults:
    temperature: "0.7"
    contextWindow: {{ .Values.ollama.contextWindow }}
    truncationStrategy: sliding
---
# ConfigMap for the tools demo PromptPack
apiVersion: v1
kind: ConfigMap
metadata:
  name: demo-tools-prompts
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-tools-demo
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
data:
  pack.json: |
    {
      "$schema": "https://promptpack.org/schema/latest/promptpack.schema.json",
      "id": "demo-tools-prompts",
      "name": "Demo Tools Prompts",
      "version": "1.0.0",
      "template_engine": {
        "version": "v1",
        "syntax": "{{"{{variable}}"}}"
      },
      "prompts": {
        "default": {
          "id": "default",
          "name": "Tools Assistant",
          "version": "1.0.0",
          "system_template": {{ .Values.toolsDemo.promptPack.systemPrompt | toJson }},
          "parameters": {
            "temperature": 0.7
          }
        }
      }
    }
---
# PromptPack for the tools demo agent
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: PromptPack
metadata:
  name: demo-tools-prompts
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-tools-demo
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
spec:
  source:
    type: configmap
    configMapRef:
      name: demo-tools-prompts
  version: "1.0.0"
  rollout:
    type: immediate
---
# ToolRegistry for tools demo agents
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: ToolRegistry
metadata:
  name: demo-tools
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-tools-demo
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
spec:
  handlers:
    - name: weather
      type: http
      timeout: 10s
      httpConfig:
        endpoint: https://api.weather.example.com/v1/current
        method: GET
        contentType: application/json
      tool:
        name: get_weather
        description: Get current weather for a location
        inputSchema:
          type: object
          properties:
            location:
              type: string
              description: City name or coordinates
          required:
            - location
    - name: calculator
      type: http
      timeout: 5s
      httpConfig:
        endpoint: https://api.calculator.example.com/v1/compute
        method: POST
        contentType: application/json
      tool:
        name: calculate
        description: Perform mathematical calculations
        inputSchema:
          type: object
          properties:
            expression:
              type: string
              description: Mathematical expression to evaluate
          required:
            - expression
---
# Tools Demo AgentRuntime using llama3.2 with tool capabilities
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: AgentRuntime
metadata:
  name: {{ .Values.toolsDemo.agent.name }}
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-tools-demo
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
    omnia.altairalabs.ai/workspace: demo
spec:
  promptPackRef:
    name: demo-tools-prompts
  providerRef:
    name: ollama-tools
  toolRegistryRef:
    name: demo-tools
  facade:
    type: websocket
    port: 8080
    handler: {{ .Values.toolsDemo.agent.handler }}
  session:
    type: memory
    ttl: "1h"
  runtime:
    replicas: {{ .Values.toolsDemo.agent.replicas }}
    resources:
      {{- toYaml .Values.toolsDemo.agent.resources | nindent 6 }}
{{- end }}
{{- /* ============================================================================ */ -}}
{{- /* LangChain Demo Resources */ -}}
{{- /* Mirrors vision-demo and tools-demo using LangChain framework */ -}}
{{- /* ============================================================================ */ -}}
{{- if .Values.langchainDemo.enabled }}
---
# LangChain Vision Demo AgentRuntime
# Uses the same PromptPack and Provider as vision-demo, but with LangChain framework
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: AgentRuntime
metadata:
  name: {{ .Values.langchainDemo.visionAgent.name }}
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-langchain-demo
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
    omnia.altairalabs.ai/workspace: demo
spec:
  # Use LangChain framework instead of PromptKit
  framework:
    type: langchain
    {{- with .Values.langchainDemo.image }}
    image: "{{ .repository }}:{{ .tag }}"
    {{- end }}
  promptPackRef:
    name: demo-vision-prompts
  providerRef:
    name: ollama
  facade:
    type: websocket
    port: 8080
    handler: runtime
  session:
    type: memory
    ttl: "1h"
  runtime:
    replicas: {{ .Values.langchainDemo.visionAgent.replicas }}
    resources:
      {{- toYaml .Values.langchainDemo.visionAgent.resources | nindent 6 }}
  {{- with .Values.agent.console }}
  console:
    maxFileSize: {{ .maxFileSize | int64 }}
    maxFiles: {{ .maxFiles }}
    allowedAttachmentTypes:
      {{- toYaml .allowedAttachmentTypes | nindent 6 }}
    {{- with .mediaRequirements }}
    mediaRequirements:
      image:
        maxDimensions:
          width: {{ .image.maxWidth }}
          height: {{ .image.maxHeight }}
        recommendedDimensions:
          width: {{ .image.recommendedWidth }}
          height: {{ .image.recommendedHeight }}
        maxSizeBytes: {{ .image.maxSizeBytes | int64 }}
        preferredFormat: {{ .image.preferredFormat | quote }}
        compressionGuidance: {{ .image.compressionGuidance | quote }}
    {{- end }}
  {{- end }}
---
# LangChain Tools Demo AgentRuntime
# Uses the same PromptPack and Provider as tools-demo, but with LangChain framework
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: AgentRuntime
metadata:
  name: {{ .Values.langchainDemo.toolsAgent.name }}
  namespace: {{ .Values.namespace }}
  labels:
    app.kubernetes.io/name: omnia-langchain-demo
    app.kubernetes.io/part-of: {{ include "omnia-demos.name" . }}
    omnia.altairalabs.ai/workspace: demo
spec:
  # Use LangChain framework instead of PromptKit
  framework:
    type: langchain
    {{- with .Values.langchainDemo.image }}
    image: "{{ .repository }}:{{ .tag }}"
    {{- end }}
  promptPackRef:
    name: demo-tools-prompts
  providerRef:
    name: ollama-tools
  toolRegistryRef:
    name: demo-tools
  facade:
    type: websocket
    port: 8080
    handler: runtime
  session:
    type: memory
    ttl: "1h"
  runtime:
    replicas: {{ .Values.langchainDemo.toolsAgent.replicas }}
    resources:
      {{- toYaml .Values.langchainDemo.toolsAgent.resources | nindent 6 }}
{{- end }}
