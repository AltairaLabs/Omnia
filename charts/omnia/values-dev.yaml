# Development values for Omnia Helm chart
#
# Used by Tilt for local development. Optimized for fast iteration:
# - Reduced resource requests
# - Disabled observability stack (Prometheus, Grafana, Loki)
# - Development-friendly settings

# Operator settings
image:
  pullPolicy: Never  # Use locally built images
replicaCount: 1
resources:
  limits:
    cpu: 500m
    memory: 384Mi
  requests:
    cpu: 100m
    memory: 192Mi

# Dashboard settings
dashboard:
  enabled: true
  image:
    pullPolicy: Never
  resources:
    limits:
      cpu: "2"
      memory: 2Gi    # Next.js dev mode with Turbopack needs lots of memory
    requests:
      cpu: 200m
      memory: 1Gi
  # Startup probe gives Next.js time to compile before liveness checks start
  # Turbopack initial compilation can take 30-60 seconds
  startupProbe:
    httpGet:
      path: /api/health
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 5
    failureThreshold: 30  # 5s * 30 = 150s max startup time
  # More lenient liveness probe for dev (compilation spikes can cause delays)
  livenessProbe:
    initialDelaySeconds: 10
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 5
  # Readiness probe for dev
  readinessProbe:
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 10
    failureThreshold: 3
  # Relaxed security for dev (Next.js needs to write .next/)
  podSecurityContext:
    runAsNonRoot: false
    runAsUser: 0
  # Development auth settings
  auth:
    mode: anonymous
    anonymousRole: admin  # Full access for development
  # WebSocket proxy URL for local development (Tilt forwards port 3002)
  wsProxy:
    url: "ws://localhost:3002"
  # Grafana URL for local development (Tilt forwards port 3001)
  grafana:
    url: "http://localhost:3001"

# Disable read-only filesystem for dev (Next.js needs to write .next/)
securityContext:
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# API settings
api:
  enabled: true
  port: 8082

# Disable observability stack for faster startup
prometheus:
  enabled: false

grafana:
  enabled: false

loki:
  enabled: false

tempo:
  enabled: false

# Disable gateways for dev (use port-forward instead)
gateway:
  enabled: false

internalGateway:
  enabled: false

# Redis is disabled by default - only needed for enterprise Arena features
# Enable via: ENABLE_ENTERPRISE=true tilt up
redis:
  enabled: false

# ============================================================================
# Workspace Content Storage (RWX via hostPath)
# ============================================================================
# Controller and dashboard both need to mount the same PVC for Arena content.
# For local dev, hostPath maps to a folder on your machine.

nfs:
  server:
    enabled: false  # Using hostPath instead for local dev
  provisioner:
    enabled: false

# Workspace content - uses hostPath for local dev (RWX on single-node clusters)
workspaceContent:
  enabled: true
  # HostPath for local development - maps to folder on your machine
  hostPath:
    enabled: true
    # Path on your local machine (Docker Desktop/kind mounts this into the VM)
    # For Docker Desktop on macOS: use /tmp or a path under your home directory
    # For kind: the path is inside the kind container, not your host
    path: /tmp/omnia-workspace-content
  persistence:
    accessModes:
      - ReadWriteMany
    size: 10Gi
