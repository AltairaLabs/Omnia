# Development values for Omnia Helm chart
#
# Used by Tilt for local development. Optimized for fast iteration:
# - Reduced resource requests
# - Disabled observability stack (Prometheus, Grafana, Loki)
# - Development-friendly settings

# Operator settings
image:
  pullPolicy: Never  # Use locally built images
replicaCount: 1
resources:
  limits:
    cpu: 500m
    memory: 384Mi
  requests:
    cpu: 100m
    memory: 192Mi

# Dashboard settings
dashboard:
  enabled: true
  image:
    pullPolicy: Never
  resources:
    limits:
      cpu: "2"
      memory: 2Gi    # Next.js dev mode with Turbopack needs lots of memory
    requests:
      cpu: 200m
      memory: 1Gi
  # Startup probe gives Next.js time to compile before liveness checks start
  # Turbopack initial compilation can take 30-60 seconds
  startupProbe:
    httpGet:
      path: /api/health
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 5
    failureThreshold: 30  # 5s * 30 = 150s max startup time
  # More lenient liveness probe for dev (compilation spikes can cause delays)
  livenessProbe:
    initialDelaySeconds: 10
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 5
  # Readiness probe for dev
  readinessProbe:
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 10
    failureThreshold: 3
  # Relaxed security for dev (Next.js needs to write .next/)
  podSecurityContext:
    runAsNonRoot: false
    runAsUser: 0
  # Development auth settings
  auth:
    mode: anonymous
    anonymousRole: admin  # Full access for development
  # WebSocket proxy URL for local development (Tilt forwards port 3002)
  wsProxy:
    url: "ws://localhost:3002"
  # Grafana URL for local development (Tilt forwards port 3001)
  grafana:
    url: "http://localhost:3001"

# Disable read-only filesystem for dev (Next.js needs to write .next/)
securityContext:
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL

# API settings
api:
  enabled: true
  port: 8082

# Disable observability stack for faster startup
prometheus:
  enabled: false

grafana:
  enabled: false

loki:
  enabled: false

tempo:
  enabled: false

# Disable gateways for dev (use port-forward instead)
gateway:
  enabled: false

internalGateway:
  enabled: false

# Enable Redis for Arena queue development (Bitnami Redis)
redis:
  enabled: true
  architecture: standalone
  image:
    tag: latest  # Use latest for dev to avoid version mismatch issues
  auth:
    enabled: false  # No auth for dev
  master:
    persistence:
      enabled: false  # No persistence for dev
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 50m
        memory: 64Mi

# Arena queue configuration
arena:
  queue:
    type: redis
    redis:
      # Auto-configured to use the Bitnami Redis subchart
      host: "omnia-redis-master"
      port: 6379
