{{- if and .Values.enterprise.enabled .Values.enterprise.communityTemplates.enabled }}
{{- $namespace := .Values.enterprise.communityTemplates.namespace | default "dev-agents" }}
---
# Create namespace for community templates if it doesn't exist
apiVersion: v1
kind: Namespace
metadata:
  name: {{ $namespace }}
  labels:
    {{- include "omnia.labels" . | nindent 4 }}
    app.kubernetes.io/component: community-templates
  annotations:
    # Use post-install/post-upgrade hooks to ensure namespace is created before ArenaTemplateSource
    "helm.sh/hook": post-install,post-upgrade
    "helm.sh/hook-weight": "5"
---
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: ArenaTemplateSource
metadata:
  name: {{ .Values.enterprise.communityTemplates.name | default "community-templates" }}
  namespace: {{ $namespace }}
  labels:
    {{- include "omnia.labels" . | nindent 4 }}
    app.kubernetes.io/component: community-templates
  annotations:
    # Use post-install/post-upgrade hooks to ensure CRD is installed before this CR
    "helm.sh/hook": post-install,post-upgrade
    "helm.sh/hook-weight": "10"
    "helm.sh/hook-delete-policy": before-hook-creation
spec:
  type: git
  git:
    url: {{ .Values.enterprise.communityTemplates.url | default "https://github.com/AltairaLabs/promptkit-templates.git" }}
    ref:
      branch: {{ .Values.enterprise.communityTemplates.branch | default "main" }}
  templatesPath: {{ .Values.enterprise.communityTemplates.templatesPath | default "" | quote }}
  syncInterval: {{ .Values.enterprise.communityTemplates.syncInterval | default "1h" }}
  timeout: {{ .Values.enterprise.communityTemplates.timeout | default "2m" }}
{{- end }}
