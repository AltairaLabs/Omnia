{{- if and .Values.enterprise.enabled (index .Values.compliance.presets "ccpa") }}
apiVersion: omnia.altairalabs.ai/v1alpha1
kind: SessionPrivacyPolicy
metadata:
  name: ccpa-compliant
  labels:
    omnia.altairalabs.ai/compliance-preset: ccpa
    {{- include "omnia.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": post-install,post-upgrade
    "helm.sh/hook-weight": "10"
    "helm.sh/hook-delete-policy": before-hook-creation
spec:
  level: workspace
  recording:
    enabled: true
    facadeData: true
    richData: false
    pii:
      redact: true
      encrypt: false
      patterns:
        - ssn
        - credit_card
        - email
      strategy: mask
  retention:
    facade:
      warmDays: 30
      coldDays: 30
  userOptOut:
    enabled: true
    honorDeleteRequests: true
    deleteWithinDays: 45
  auditLog:
    enabled: true
    retentionDays: 365
{{- end }}
