---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: workspaces.omnia.altairalabs.ai
spec:
  group: omnia.altairalabs.ai
  names:
    kind: Workspace
    listKind: WorkspaceList
    plural: workspaces
    singular: workspace
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.displayName
      name: Display Name
      type: string
    - jsonPath: .spec.environment
      name: Environment
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.namespace.name
      name: Namespace
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          Workspace is the Schema for the workspaces API.
          It defines a multi-tenant workspace with isolated namespace, RBAC, and resource quotas.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of Workspace
            properties:
              anonymousAccess:
                description: |-
                  anonymousAccess configures access for unauthenticated users.
                  If omitted, anonymous users have no access to this workspace.
                  WARNING: Granting editor or owner allows anonymous users to modify resources.
                properties:
                  enabled:
                    description: |-
                      enabled specifies whether anonymous users can access this workspace.
                      If false or omitted, anonymous users have no access.
                    type: boolean
                  role:
                    description: |-
                      role is the workspace role granted to anonymous users.
                      Defaults to viewer if enabled is true but role is not specified.
                      WARNING: editor and owner grant write access to anonymous users.
                    enum:
                    - owner
                    - editor
                    - viewer
                    type: string
                required:
                - enabled
                type: object
              costControls:
                description: costControls defines budget and cost control settings.
                properties:
                  alertThresholds:
                    description: alertThresholds defines thresholds for cost alerts.
                    items:
                      description: CostAlertThreshold defines a threshold for cost
                        alerts.
                      properties:
                        notify:
                          description: notify is a list of email addresses to notify
                            when threshold is reached.
                          items:
                            type: string
                          type: array
                        percent:
                          description: percent is the percentage of budget at which
                            to trigger the alert.
                          format: int32
                          maximum: 100
                          minimum: 1
                          type: integer
                      required:
                      - percent
                      type: object
                    type: array
                  budgetExceededAction:
                    default: warn
                    description: budgetExceededAction defines what action to take
                      when budget is exceeded.
                    enum:
                    - warn
                    - pauseJobs
                    - block
                    type: string
                  dailyBudget:
                    description: dailyBudget is the maximum daily spending limit in
                      USD (e.g., "100.00").
                    type: string
                  monthlyBudget:
                    description: monthlyBudget is the maximum monthly spending limit
                      in USD (e.g., "2000.00").
                    type: string
                type: object
              defaultTags:
                additionalProperties:
                  type: string
                description: |-
                  defaultTags are labels applied to all resources created in this workspace.
                  Used for cost attribution and resource organization.
                type: object
              description:
                description: description is an optional description of the workspace.
                type: string
              directGrants:
                description: directGrants are direct user grants for exceptions (use
                  sparingly).
                items:
                  description: DirectGrant defines a direct user grant for workspace
                    access.
                  properties:
                    expires:
                      description: expires is an optional expiration time for this
                        grant.
                      format: date-time
                      type: string
                    role:
                      description: role is the workspace role to grant.
                      enum:
                      - owner
                      - editor
                      - viewer
                      type: string
                    user:
                      description: user is the email or username of the user.
                      minLength: 1
                      type: string
                  required:
                  - role
                  - user
                  type: object
                type: array
              displayName:
                description: displayName is the human-readable name for this workspace.
                maxLength: 256
                minLength: 1
                type: string
              environment:
                default: development
                description: environment is the tier for this workspace (development,
                  staging, production).
                enum:
                - development
                - staging
                - production
                type: string
              namespace:
                description: namespace configures the Kubernetes namespace for this
                  workspace.
                properties:
                  annotations:
                    additionalProperties:
                      type: string
                    description: annotations are additional annotations to apply to
                      the namespace.
                    type: object
                  create:
                    description: |-
                      create specifies whether to auto-create the namespace if it doesn't exist.
                      Defaults to false for safety - users must explicitly enable namespace creation.
                    type: boolean
                  labels:
                    additionalProperties:
                      type: string
                    description: labels are additional labels to apply to the namespace.
                    type: object
                  name:
                    description: name is the name of the namespace for this workspace.
                    maxLength: 63
                    minLength: 1
                    pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                    type: string
                required:
                - name
                type: object
              networkPolicy:
                description: networkPolicy defines network isolation settings for
                  this workspace.
                properties:
                  allowExternalAPIs:
                    description: |-
                      allowExternalAPIs enables egress to external IPs (0.0.0.0/0 except private ranges).
                      Defaults to true when isolate is enabled.
                    type: boolean
                  allowFrom:
                    description: allowFrom defines additional ingress rules.
                    items:
                      description: NetworkPolicyRule defines a single ingress or egress
                        rule.
                      properties:
                        peers:
                          description: peers is a list of sources (for ingress) or
                            destinations (for egress).
                          items:
                            description: NetworkPolicyPeer describes a peer to allow
                              traffic to/from.
                            properties:
                              ipBlock:
                                description: ipBlock defines CIDR ranges to allow
                                  traffic to/from.
                                properties:
                                  cidr:
                                    description: cidr is a string representing the
                                      IP block (e.g., "192.168.1.0/24" or "0.0.0.0/0").
                                    type: string
                                  except:
                                    description: except is a list of CIDRs that should
                                      not be included within the IP block.
                                    items:
                                      type: string
                                    type: array
                                required:
                                - cidr
                                type: object
                              namespaceSelector:
                                description: namespaceSelector selects namespaces
                                  by label.
                                properties:
                                  matchLabels:
                                    additionalProperties:
                                      type: string
                                    description: matchLabels is a map of key-value
                                      pairs for label matching.
                                    type: object
                                type: object
                              podSelector:
                                description: podSelector selects pods by label within
                                  the selected namespaces.
                                properties:
                                  matchLabels:
                                    additionalProperties:
                                      type: string
                                    description: matchLabels is a map of key-value
                                      pairs for label matching.
                                    type: object
                                type: object
                            type: object
                          type: array
                        ports:
                          description: ports is a list of ports to allow.
                          items:
                            description: NetworkPolicyPort describes a port to allow
                              traffic on.
                            properties:
                              port:
                                description: port is the port number or name.
                                format: int32
                                type: integer
                              protocol:
                                default: TCP
                                description: protocol is the protocol (TCP, UDP, or
                                  SCTP).
                                enum:
                                - TCP
                                - UDP
                                - SCTP
                                type: string
                            required:
                            - port
                            type: object
                          type: array
                      type: object
                    type: array
                  allowPrivateNetworks:
                    description: |-
                      allowPrivateNetworks removes the RFC 1918 private IP exclusions (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16)
                      from the external APIs rule. Use this for local development or when agents need to access
                      services on private networks. Defaults to false for security.
                    type: boolean
                  allowSharedNamespaces:
                    description: |-
                      allowSharedNamespaces enables traffic to/from namespaces labeled omnia.altairalabs.ai/shared: true.
                      Defaults to true when isolate is enabled.
                    type: boolean
                  allowTo:
                    description: allowTo defines additional egress rules.
                    items:
                      description: NetworkPolicyRule defines a single ingress or egress
                        rule.
                      properties:
                        peers:
                          description: peers is a list of sources (for ingress) or
                            destinations (for egress).
                          items:
                            description: NetworkPolicyPeer describes a peer to allow
                              traffic to/from.
                            properties:
                              ipBlock:
                                description: ipBlock defines CIDR ranges to allow
                                  traffic to/from.
                                properties:
                                  cidr:
                                    description: cidr is a string representing the
                                      IP block (e.g., "192.168.1.0/24" or "0.0.0.0/0").
                                    type: string
                                  except:
                                    description: except is a list of CIDRs that should
                                      not be included within the IP block.
                                    items:
                                      type: string
                                    type: array
                                required:
                                - cidr
                                type: object
                              namespaceSelector:
                                description: namespaceSelector selects namespaces
                                  by label.
                                properties:
                                  matchLabels:
                                    additionalProperties:
                                      type: string
                                    description: matchLabels is a map of key-value
                                      pairs for label matching.
                                    type: object
                                type: object
                              podSelector:
                                description: podSelector selects pods by label within
                                  the selected namespaces.
                                properties:
                                  matchLabels:
                                    additionalProperties:
                                      type: string
                                    description: matchLabels is a map of key-value
                                      pairs for label matching.
                                    type: object
                                type: object
                            type: object
                          type: array
                        ports:
                          description: ports is a list of ports to allow.
                          items:
                            description: NetworkPolicyPort describes a port to allow
                              traffic on.
                            properties:
                              port:
                                description: port is the port number or name.
                                format: int32
                                type: integer
                              protocol:
                                default: TCP
                                description: protocol is the protocol (TCP, UDP, or
                                  SCTP).
                                enum:
                                - TCP
                                - UDP
                                - SCTP
                                type: string
                            required:
                            - port
                            type: object
                          type: array
                      type: object
                    type: array
                  isolate:
                    description: |-
                      isolate enables network isolation for the workspace namespace.
                      When true, a NetworkPolicy is created to restrict traffic.
                    type: boolean
                type: object
              quotas:
                description: quotas defines resource quotas for this workspace.
                properties:
                  agents:
                    description: agents defines AgentRuntime-specific quotas.
                    properties:
                      maxAgentRuntimes:
                        description: maxAgentRuntimes is the maximum number of AgentRuntimes
                          allowed.
                        format: int32
                        type: integer
                      maxReplicasPerAgent:
                        description: maxReplicasPerAgent is the maximum replicas per
                          AgentRuntime.
                        format: int32
                        type: integer
                    type: object
                  arena:
                    description: arena defines Arena-specific quotas.
                    properties:
                      maxConcurrentJobs:
                        description: maxConcurrentJobs is the maximum number of concurrent
                          Arena jobs.
                        format: int32
                        type: integer
                      maxJobsPerDay:
                        description: maxJobsPerDay is the maximum number of Arena
                          jobs per day.
                        format: int32
                        type: integer
                      maxWorkersPerJob:
                        description: maxWorkersPerJob is the maximum number of workers
                          per Arena job.
                        format: int32
                        type: integer
                    type: object
                  compute:
                    description: compute defines compute resource quotas.
                    properties:
                      limits.cpu:
                        description: limitsCPU is the total CPU limits allowed (e.g.,
                          "100").
                        type: string
                      limits.memory:
                        description: limitsMemory is the total memory limits allowed
                          (e.g., "200Gi").
                        type: string
                      requests.cpu:
                        description: requestsCPU is the total CPU requests allowed
                          (e.g., "50").
                        type: string
                      requests.memory:
                        description: requestsMemory is the total memory requests allowed
                          (e.g., "100Gi").
                        type: string
                    type: object
                  objects:
                    description: objects defines object count quotas.
                    properties:
                      configmaps:
                        description: configmaps is the maximum number of ConfigMaps
                          allowed.
                        format: int32
                        type: integer
                      persistentvolumeclaims:
                        description: persistentvolumeclaims is the maximum number
                          of PVCs allowed.
                        format: int32
                        type: integer
                      secrets:
                        description: secrets is the maximum number of Secrets allowed.
                        format: int32
                        type: integer
                    type: object
                type: object
              roleBindings:
                description: roleBindings maps IdP groups and ServiceAccounts to workspace
                  roles.
                items:
                  description: RoleBinding defines a mapping from groups or ServiceAccounts
                    to a workspace role.
                  properties:
                    groups:
                      description: |-
                        groups is a list of IdP group names that should be granted this role.
                        Group names must exactly match IdP group claim values.
                      items:
                        type: string
                      type: array
                    role:
                      description: role is the workspace role to grant.
                      enum:
                      - owner
                      - editor
                      - viewer
                      type: string
                    serviceAccounts:
                      description: serviceAccounts is a list of ServiceAccounts that
                        should be granted this role.
                      items:
                        description: ServiceAccountRef references a ServiceAccount.
                        properties:
                          name:
                            description: name is the name of the ServiceAccount.
                            minLength: 1
                            type: string
                          namespace:
                            description: namespace is the namespace of the ServiceAccount.
                            minLength: 1
                            type: string
                        required:
                        - name
                        - namespace
                        type: object
                      type: array
                  required:
                  - role
                  type: object
                type: array
              storage:
                description: |-
                  storage configures shared storage for this workspace.
                  When enabled, a PVC is created for storing Arena content, PromptPacks, and datasets.
                  Job runners and dashboard mount this PVC directly for efficient content access.
                properties:
                  accessModes:
                    default:
                    - ReadWriteMany
                    description: |-
                      accessModes specifies the PVC access modes.
                      Defaults to ReadWriteMany for shared access by dashboard and job runners.
                    items:
                      type: string
                    type: array
                  enabled:
                    default: true
                    description: |-
                      enabled specifies whether to create a shared PVC for this workspace.
                      When enabled, a PVC is created and mounted by dashboard and job runners.
                    type: boolean
                  retentionPolicy:
                    default: Delete
                    description: retentionPolicy specifies what happens to the PVC
                      when the workspace is deleted.
                    enum:
                    - Delete
                    - Retain
                    type: string
                  size:
                    default: 10Gi
                    description: size is the requested storage size (e.g., "10Gi").
                    type: string
                  storageClass:
                    description: |-
                      storageClass is the Kubernetes storage class to use for the PVC.
                      If not specified, the cluster default storage class is used.
                      For production, use a ReadWriteMany-capable storage class (e.g., EFS, NFS).
                    type: string
                type: object
            required:
            - displayName
            - namespace
            type: object
          status:
            description: status defines the observed state of Workspace
            properties:
              conditions:
                description: conditions represent the current state of the Workspace
                  resource.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              costUsage:
                description: costUsage tracks the current cost usage for this workspace.
                properties:
                  dailyBudget:
                    description: dailyBudget is the configured daily budget in USD.
                    type: string
                  dailySpend:
                    description: dailySpend is the current day's spending in USD.
                    type: string
                  lastUpdated:
                    description: lastUpdated is the timestamp of the last cost calculation.
                    format: date-time
                    type: string
                  monthlyBudget:
                    description: monthlyBudget is the configured monthly budget in
                      USD.
                    type: string
                  monthlySpend:
                    description: monthlySpend is the current month's spending in USD.
                    type: string
                type: object
              members:
                description: members tracks the count of members by role.
                properties:
                  editors:
                    description: editors is the count of editor members.
                    format: int32
                    type: integer
                  owners:
                    description: owners is the count of owner members.
                    format: int32
                    type: integer
                  viewers:
                    description: viewers is the count of viewer members.
                    format: int32
                    type: integer
                type: object
              namespace:
                description: namespace tracks the status of the workspace namespace.
                properties:
                  created:
                    description: created indicates whether the namespace was created
                      by the controller.
                    type: boolean
                  name:
                    description: name is the name of the namespace.
                    type: string
                type: object
              networkPolicy:
                description: networkPolicy tracks the status of the workspace NetworkPolicy.
                properties:
                  enabled:
                    description: enabled indicates whether network isolation is active.
                    type: boolean
                  name:
                    description: name is the name of the generated NetworkPolicy.
                    type: string
                  rulesCount:
                    description: rulesCount is the total number of ingress and egress
                      rules.
                    format: int32
                    type: integer
                type: object
              observedGeneration:
                description: observedGeneration is the most recent generation observed
                  by the controller.
                format: int64
                type: integer
              phase:
                description: phase represents the current lifecycle phase of the Workspace.
                enum:
                - Pending
                - Ready
                - Suspended
                - Error
                type: string
              serviceAccounts:
                description: serviceAccounts tracks the workspace ServiceAccounts.
                properties:
                  editor:
                    description: editor is the name of the editor ServiceAccount.
                    type: string
                  owner:
                    description: owner is the name of the owner ServiceAccount.
                    type: string
                  viewer:
                    description: viewer is the name of the viewer ServiceAccount.
                    type: string
                type: object
              storage:
                description: storage tracks the status of workspace shared storage.
                properties:
                  capacity:
                    description: capacity is the actual provisioned capacity of the
                      PVC.
                    type: string
                  mountPath:
                    description: mountPath is the path where the PVC is mounted (e.g.,
                      /workspace-content/{workspace}/default).
                    type: string
                  phase:
                    description: phase is the current phase of the PVC (Pending, Bound,
                      Lost).
                    type: string
                  pvcName:
                    description: pvcName is the name of the PVC created for this workspace.
                    type: string
                type: object
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
