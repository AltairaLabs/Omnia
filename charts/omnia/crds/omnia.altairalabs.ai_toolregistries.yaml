---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: toolregistries.omnia.altairalabs.ai
spec:
  group: omnia.altairalabs.ai
  names:
    kind: ToolRegistry
    listKind: ToolRegistryList
    plural: toolregistries
    singular: toolregistry
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Number of discovered tools
      jsonPath: .status.discoveredToolsCount
      name: Tools
      type: integer
    - description: Current phase
      jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          ToolRegistry is the Schema for the toolregistries API.
          It defines a collection of tool handlers that expose tools to agents.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: spec defines the desired state of ToolRegistry
            properties:
              handlers:
                description: |-
                  handlers defines the list of tool handlers in this registry.
                  Each handler can expose one or more tools.
                items:
                  description: HandlerDefinition defines a tool handler that exposes
                    one or more tools
                  properties:
                    grpcConfig:
                      description: |-
                        grpcConfig contains gRPC-specific configuration.
                        Required when type is "grpc".
                      properties:
                        endpoint:
                          description: endpoint is the gRPC server address (host:port).
                          type: string
                        tls:
                          description: tls enables TLS for the connection.
                          type: boolean
                        tlsCAPath:
                          description: tlsCAPath is the path to the CA certificate.
                          type: string
                        tlsCertPath:
                          description: tlsCertPath is the path to the TLS certificate.
                          type: string
                        tlsInsecureSkipVerify:
                          description: tlsInsecureSkipVerify skips TLS verification
                            (not recommended for production).
                          type: boolean
                        tlsKeyPath:
                          description: tlsKeyPath is the path to the TLS key.
                          type: string
                      required:
                      - endpoint
                      type: object
                    httpConfig:
                      description: |-
                        httpConfig contains HTTP-specific configuration.
                        Required when type is "http".
                      properties:
                        authSecretRef:
                          description: authSecretRef references a secret containing
                            auth credentials.
                          properties:
                            key:
                              description: key is the key in the secret to select.
                              type: string
                            name:
                              description: name is the name of the secret.
                              type: string
                          required:
                          - key
                          - name
                          type: object
                        authType:
                          description: authType specifies the authentication type
                            (none, bearer, basic).
                          type: string
                        contentType:
                          default: application/json
                          description: |-
                            contentType is the Content-Type header value.
                            Defaults to "application/json".
                          type: string
                        endpoint:
                          description: endpoint is the HTTP endpoint URL.
                          type: string
                        headers:
                          additionalProperties:
                            type: string
                          description: headers are additional HTTP headers to include
                            in requests.
                          type: object
                        method:
                          default: POST
                          description: |-
                            method is the HTTP method to use (GET, POST, PUT, DELETE).
                            Defaults to POST.
                          type: string
                      required:
                      - endpoint
                      type: object
                    mcpConfig:
                      description: |-
                        mcpConfig contains MCP-specific configuration.
                        Required when type is "mcp".
                      properties:
                        args:
                          description: args are the command arguments for stdio transport.
                          items:
                            type: string
                          type: array
                        command:
                          description: command is the command to run for stdio transport.
                          type: string
                        endpoint:
                          description: endpoint is the SSE server URL (required for
                            SSE transport).
                          type: string
                        env:
                          additionalProperties:
                            type: string
                          description: env are additional environment variables for
                            stdio transport.
                          type: object
                        transport:
                          description: transport specifies the MCP transport type.
                          enum:
                          - sse
                          - stdio
                          type: string
                        workDir:
                          description: workDir is the working directory for stdio
                            transport.
                          type: string
                      required:
                      - transport
                      type: object
                    name:
                      description: name is a unique identifier for this handler within
                        the registry.
                      maxLength: 63
                      pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                      type: string
                    openAPIConfig:
                      description: |-
                        openAPIConfig contains OpenAPI-specific configuration.
                        Required when type is "openapi".
                      properties:
                        baseURL:
                          description: |-
                            baseURL overrides the base URL from the OpenAPI spec.
                            If not specified, uses the first server URL from the spec.
                          type: string
                        operationFilter:
                          description: |-
                            operationFilter limits which operations are exposed as tools.
                            If empty, all operations are exposed.
                          items:
                            type: string
                          type: array
                        specURL:
                          description: specURL is the URL to the OpenAPI specification
                            (JSON or YAML).
                          type: string
                      required:
                      - specURL
                      type: object
                    retries:
                      default: 0
                      description: retries specifies the number of retry attempts
                        on failure.
                      format: int32
                      maximum: 10
                      minimum: 0
                      type: integer
                    selector:
                      description: |-
                        selector discovers the handler endpoint from Kubernetes Services.
                        Mutually exclusive with inline endpoint configuration.
                      properties:
                        matchLabels:
                          additionalProperties:
                            type: string
                          description: matchLabels specifies labels that must match
                            on the Service.
                          type: object
                        namespace:
                          description: |-
                            namespace specifies the namespace to search for Services.
                            If empty, searches in the same namespace as the ToolRegistry.
                          type: string
                        port:
                          description: |-
                            port specifies the port name or number on the Service.
                            If empty, uses the first port.
                          type: string
                      type: object
                    timeout:
                      default: 30s
                      description: |-
                        timeout specifies the maximum duration for tool invocation.
                        Defaults to "30s".
                      type: string
                    tool:
                      description: |-
                        tool defines the tool interface (required for http and grpc types).
                        Self-describing handlers (mcp, openapi) discover tools automatically.
                      properties:
                        description:
                          description: description explains what the tool does (shown
                            to LLM).
                          type: string
                        inputSchema:
                          description: inputSchema is the JSON Schema for the tool's
                            input parameters.
                          x-kubernetes-preserve-unknown-fields: true
                        name:
                          description: name is the tool name that will be exposed
                            to the LLM.
                          maxLength: 64
                          pattern: ^[a-z][a-z0-9_]*$
                          type: string
                        outputSchema:
                          description: outputSchema is the JSON Schema for the tool's
                            output.
                          x-kubernetes-preserve-unknown-fields: true
                      required:
                      - description
                      - inputSchema
                      - name
                      type: object
                    type:
                      description: type specifies the handler protocol.
                      enum:
                      - http
                      - openapi
                      - grpc
                      - mcp
                      type: string
                  required:
                  - name
                  - type
                  type: object
                minItems: 1
                type: array
            required:
            - handlers
            type: object
          status:
            description: status defines the observed state of ToolRegistry
            properties:
              conditions:
                description: conditions represent the current state of the ToolRegistry
                  resource.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              discoveredTools:
                description: discoveredTools contains details of each discovered tool.
                items:
                  description: DiscoveredTool represents a tool discovered from a
                    handler
                  properties:
                    description:
                      description: description is the tool description (for LLM)
                      type: string
                    endpoint:
                      description: endpoint is the resolved endpoint URL/address
                      type: string
                    error:
                      description: error contains the error message if status is Unavailable
                      type: string
                    handlerName:
                      description: handlerName is the handler that provides this tool
                      type: string
                    inputSchema:
                      description: inputSchema is the JSON Schema for input parameters
                      x-kubernetes-preserve-unknown-fields: true
                    lastChecked:
                      description: lastChecked is the timestamp of the last availability
                        check
                      format: date-time
                      type: string
                    name:
                      description: name is the tool name (used by LLM)
                      type: string
                    outputSchema:
                      description: outputSchema is the JSON Schema for output
                      x-kubernetes-preserve-unknown-fields: true
                    status:
                      description: status indicates whether the tool is available
                      enum:
                      - Available
                      - Unavailable
                      - Unknown
                      type: string
                  required:
                  - description
                  - endpoint
                  - handlerName
                  - name
                  - status
                  type: object
                type: array
              discoveredToolsCount:
                description: discoveredToolsCount is the number of tools successfully
                  discovered.
                format: int32
                type: integer
              lastDiscoveryTime:
                description: lastDiscoveryTime is the timestamp of the last successful
                  discovery.
                format: date-time
                type: string
              phase:
                description: phase represents the current lifecycle phase of the ToolRegistry.
                enum:
                - Pending
                - Ready
                - Degraded
                - Failed
                type: string
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
