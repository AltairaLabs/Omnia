# SonarCloud configuration for Omnia Kubernetes Operator
sonar.projectKey=AltairaLabs_Omnia
sonar.organization=altairalabs

# Project metadata
sonar.projectName=Omnia
sonar.projectVersion=1.0

# Source configuration - Omnia kubebuilder project structure + Dashboard
# Note: Generated protobuf code is excluded from analysis (*.pb.go for Go, lib/proto/** for TypeScript)
sonar.sources=api,cmd,internal,pkg,dashboard/src
sonar.test.inclusions=**/*_test.go,**/test_*.go,**/*.test.ts,**/*.test.tsx
sonar.exclusions=**/testdata/**,**/vendor/**,**/bin/**,**/docs/**,**/*.md,**/.git/**,**/.vscode/**,**/.scannerwork/**,**/*.pb.go,**/zz_generated*.go,**/node_modules/**,**/.next/**,**/coverage/**,**/components/ui/**,**/globals.css,**/lib/proto/**

# Go specific settings
sonar.go.coverage.reportPaths=coverage.out

# TypeScript/JavaScript settings (Dashboard)
sonar.typescript.lcov.reportPaths=dashboard/coverage/lcov.info
sonar.javascript.lcov.reportPaths=dashboard/coverage/lcov.info

# Coverage exclusions - exclude from coverage requirements:
# - test utilities (test helpers, not production code)
# - generated files (zz_generated*.go - kubebuilder generated)
# - cmd/main.go (operator entry point with minimal logic)
# - cmd/agent/main.go (agent entry point with minimal logic)
# - cmd/runtime/** (entry point with minimal logic)
# - internal/session/redis.go (requires running Redis for integration tests)
# - internal/agent/metrics.go (uses promauto which registers to global registry)
# - internal/facade/metrics.go (NoOpMetrics has empty function bodies that can't be covered)
# - internal/api/server.go (logs endpoint requires real K8s clientset for integration testing)
# Dashboard exclusions:
# - dashboard/src/test/** (test setup files)
# - dashboard/src/**/*.d.ts (type definition files)
# - dashboard/src/lib/api/schema.d.ts (generated API schema)
# - dashboard/src/**/index.ts (barrel files with re-exports only)
# - dashboard/src/components/ui/** (shadcn components - vendor code)
# - dashboard/src/components/topology/** (visual graph components - tested via e2e)
# - dashboard/src/components/agents/** (visual agent components - tested via e2e)
# - dashboard/src/components/auth/** (auth form components - visual, tested via e2e)
# - dashboard/src/components/filters/** (filter UI components - visual)
# - dashboard/src/components/console/** (console components - visual, tested via e2e)
# - dashboard/src/components/logs/** (log viewer - visual component)
# - dashboard/src/components/cost/** (cost components - visual)
# - dashboard/src/components/grafana/** (grafana embed - requires Grafana)
# - dashboard/src/components/layout/** (layout components - visual)
# - dashboard/src/components/dashboard/** (dashboard components - visual)
# - dashboard/src/app/** (Next.js pages/routes - tested via e2e)
# - dashboard/src/hooks/** (React hooks - integration tested with components)
# - dashboard/src/lib/data/live-service.ts (requires live K8s cluster)
# - dashboard/src/lib/data/operator-service.ts (requires operator API)
# - dashboard/src/lib/data/prometheus-service.ts (requires Prometheus)
# - dashboard/src/lib/data/provider.tsx (React context provider)
# - dashboard/src/lib/data/types.ts (type definitions only)
# - dashboard/src/lib/auth/** (auth requires integration testing)
# - dashboard/src/lib/api/** (API client requires backend)
# - dashboard/src/lib/proto/** (generated protobuf TypeScript code)
# - dashboard/src/lib/mock-data.ts (test fixtures, not production code)
# - dashboard/src/middleware.ts (Next.js middleware - integration tested)
# - dashboard/src/types/** (type definitions only)
# - dashboard/src/types/generated/** (generated from CRDs - no tests needed)
#
# Note: The following functions in agentruntime_controller.go have limited coverage:
# - SetupWithManager (0%): kubebuilder scaffolding, tested via controller-runtime
# - reconcileKEDA (0%): requires KEDA CRDs in envtest (tested via E2E)
# The HPA tests now cover reconcileHPA (78.4%) using envtest's built-in HPA support.
#
# Note: The following packages require external infrastructure for testing:
# - internal/runtime/tracing (requires OTLP collector endpoint)
# - internal/session/redis.go (requires Redis server)
# - internal/runtime/server.go (integration with PromptKit SDK, tool registration requires real tool servers)
# - internal/media/s3.go (requires S3/MinIO/LocalStack for integration testing)
# - internal/media/gcs.go (requires GCS emulator for integration testing)
# - internal/media/azure.go (requires Azurite/Azure Blob Storage for integration testing)
# - internal/media/handler.go (HTTP handlers require storage backend integration testing)
# - internal/media/local.go (local storage requires filesystem integration testing)
# - internal/runtime/events.go (event bus subscription requires running PromptKit SDK)
# - internal/runtime/media_processing.go (media processing requires real media handling)
# - internal/api/*.go (API handlers require running K8s cluster)
sonar.coverage.exclusions=**/test/**,**/zz_generated*.go,cmd/main.go,cmd/agent/main.go,cmd/runtime/**,internal/session/redis.go,internal/agent/metrics.go,internal/facade/metrics.go,internal/api/server.go,internal/runtime/tracing/**,internal/runtime/server.go,internal/runtime/events.go,internal/runtime/media_processing.go,internal/api/*.go,internal/media/s3.go,internal/media/gcs.go,internal/media/azure.go,internal/media/handler.go,internal/media/local.go,**/*.d.ts,**/index.ts,**/index.tsx,**/components/**,**/app/**,**/hooks/**,**/lib/data/live-service.ts,**/lib/data/operator-service.ts,**/lib/data/prometheus-service.ts,**/lib/data/provider.tsx,**/lib/data/types.ts,**/lib/auth/**,**/lib/api/**,**/lib/proto/**,**/lib/mock-data.ts,**/middleware.ts,**/types/**,**/types/generated/**

# CPD (Copy Paste Detector) exclusions - interface implementations and controller patterns have intentional similarity
# Dashboard OAuth providers have intentional similarity (same interface implementation pattern)
# Tool adapters (HTTP, gRPC, OpenAPI, MCP) follow the same adapter pattern with intentional structural similarity
# Media storage implementations follow Go's idiomatic error handling patterns with intentional structural similarity
# Generated TypeScript types have intentional similarity (CRD interface patterns)
# Split controller/runtime files share patterns from original file
sonar.cpd.exclusions=internal/session/redis.go,internal/controller/provider_controller.go,internal/runtime/tools/*_adapter.go,internal/media/*.go,**/lib/auth/oauth/providers/**,**/components/ui/**,**/types/generated/**,internal/controller/*.go,internal/runtime/*.go,internal/api/*.go

# Issue ignore rules (similar to PromptKit)
# e1: Disable TODO comment rule globally - TODOs are tracked in project management
# e2-e3: Disable godre rules globally
# e4: Allow pseudo-random in mock data hooks (used for demo mode visualization)
# e5: Allow pseudo-random in lib/mock-data.ts (test fixtures)
# e6: Allow pseudo-random in mock-service.ts (demo mode data generation)
# e7: Allow HTTP URLs in mock files (not real endpoints, demo data only)
# e8: Allow high cognitive complexity in entry points (initialization code)
# e9: Allow high cognitive complexity in controllers (reconciliation logic)
# e10: Allow high cognitive complexity in API handlers (request processing)
# e11-e12: Allow event handlers on non-interactive containers (event propagation blockers)
# e13: Allow pseudo-random in test files (test data generation)
# e14: Allow any type in test files (mocking flexibility)
# e15: Allow unused expressions in test files (assertions)
# e16: Allow context.Background() in media storage (intentional for background cleanup goroutines)
sonar.issue.ignore.multicriteria=e1,e2,e3,e4,e5,e6,e7,e8,e9,e10,e11,e12,e13,e14,e15,e16
sonar.issue.ignore.multicriteria.e1.ruleKey=go:S1135
sonar.issue.ignore.multicriteria.e1.resourceKey=**/*.go
sonar.issue.ignore.multicriteria.e2.ruleKey=godre:S1172
sonar.issue.ignore.multicriteria.e2.resourceKey=**/*.go
sonar.issue.ignore.multicriteria.e3.ruleKey=godre:S8148
sonar.issue.ignore.multicriteria.e3.resourceKey=**/*.go
sonar.issue.ignore.multicriteria.e4.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.e4.resourceKey=**/dashboard/src/hooks/**
sonar.issue.ignore.multicriteria.e5.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.e5.resourceKey=**/lib/mock-data.ts
sonar.issue.ignore.multicriteria.e6.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.e6.resourceKey=**/lib/data/mock-service.ts
sonar.issue.ignore.multicriteria.e7.ruleKey=typescript:S5332
sonar.issue.ignore.multicriteria.e7.resourceKey=**/lib/mock*.ts
sonar.issue.ignore.multicriteria.e8.ruleKey=go:S3776
sonar.issue.ignore.multicriteria.e8.resourceKey=cmd/**/main.go
sonar.issue.ignore.multicriteria.e9.ruleKey=go:S3776
sonar.issue.ignore.multicriteria.e9.resourceKey=internal/controller/**
sonar.issue.ignore.multicriteria.e10.ruleKey=go:S3776
sonar.issue.ignore.multicriteria.e10.resourceKey=internal/api/**
sonar.issue.ignore.multicriteria.e11.ruleKey=typescript:S6847
sonar.issue.ignore.multicriteria.e11.resourceKey=**/components/**
sonar.issue.ignore.multicriteria.e12.ruleKey=typescript:S6819
sonar.issue.ignore.multicriteria.e12.resourceKey=**/components/**
sonar.issue.ignore.multicriteria.e13.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.e13.resourceKey=**/*.test.ts
sonar.issue.ignore.multicriteria.e14.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.e14.resourceKey=**/*.test.tsx
sonar.issue.ignore.multicriteria.e15.ruleKey=typescript:S6544
sonar.issue.ignore.multicriteria.e15.resourceKey=**/*.test.*
sonar.issue.ignore.multicriteria.e16.ruleKey=godre:S8239
sonar.issue.ignore.multicriteria.e16.resourceKey=internal/media/*.go

# Quality gate settings
sonar.qualitygate.wait=true