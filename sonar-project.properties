# SonarCloud configuration for Omnia Kubernetes Operator
sonar.projectKey=AltairaLabs_Omnia
sonar.organization=altairalabs

# Project metadata
sonar.projectName=Omnia
sonar.projectVersion=1.0

# Source configuration - Omnia kubebuilder project structure + Dashboard
# Note: Generated protobuf code is excluded from analysis (*.pb.go for Go, lib/proto/** for TypeScript)
sonar.sources=api,cmd,internal,pkg,ee,dashboard/src
sonar.test.inclusions=**/*_test.go,**/test_*.go,**/*.test.ts,**/*.test.tsx
sonar.exclusions=**/testdata/**,**/vendor/**,**/bin/**,**/docs/**,**/*.md,**/.git/**,**/.vscode/**,**/.scannerwork/**,**/*.pb.go,**/zz_generated*.go,**/node_modules/**,**/.next/**,**/coverage/**,**/components/ui/**,**/globals.css,**/lib/proto/**

# Go specific settings
sonar.go.coverage.reportPaths=coverage.out

# TypeScript/JavaScript settings (Dashboard)
sonar.typescript.lcov.reportPaths=dashboard/coverage/lcov.info
sonar.javascript.lcov.reportPaths=dashboard/coverage/lcov.info

# Coverage exclusions - only exclude what truly cannot be unit tested
#
# Go exclusions:
# - **/test/** (test utilities)
# - **/zz_generated*.go (kubebuilder generated)
# - cmd/main.go, cmd/agent/main.go, cmd/runtime/** (entry points with minimal logic)
# - ee/cmd/omnia-arena-controller/main.go (EE controller entry point)
# - ee/cmd/arena-worker/cmd.go (CLI setup with Cobra)
# - ee/cmd/arena-worker/worker.go (PromptKit arena engine integration, tested via E2E)
# - ee/internal/controller/*.go (async goroutines, K8s controllers, tested via E2E)
# - ee/internal/webhook/*.go (validation webhooks, tested via E2E)
# - ee/pkg/license/validator.go (license validation with external state)
# - ee/pkg/license/fingerprint.go (system fingerprinting)
# - internal/session/redis.go (requires Redis server)
# - internal/agent/metrics.go (promauto global registry)
# - internal/facade/metrics.go (NoOpMetrics empty bodies)
# - internal/api/*.go (requires K8s cluster)
# - internal/runtime/tracing/tracing.go (NewProvider requires OTLP connection - 8.3% untestable)
# - internal/runtime/tools_registration.go (requires full tool executor integration)
# - internal/runtime/metrics.go (promauto global registry conflicts)
# - Note: internal/runtime/*.go (except above) ARE unit tested with mock provider (67.8% coverage)
# - Note: internal/runtime/tools/*.go ARE unit tested (81.3% coverage)
# - internal/media/s3.go (requires AWS S3 - NewS3Storage, GetUploadURL, etc. interact with AWS APIs)
# - internal/media/azure.go (requires Azure Blob Storage - NewAzureStorage, etc. interact with Azure APIs)
# - internal/media/gcs.go (requires Google Cloud Storage - NewGCSStorage, etc. interact with GCS APIs)
# - Note: internal/media/local.go, storage.go, handler.go, file.go ARE unit tested (helper functions, local storage)
# - pkg/arena/queue/*.go (requires Redis)
# - internal/controller/arena*.go (async goroutines, Redis, tested via E2E)
# - internal/controller/workspace_controller.go storage functions (PVC interactions, tested via E2E)
#
# Dashboard exclusions (truly untestable):
# - **/*.d.ts (type definitions)
# - **/index.ts (barrel re-exports)
# - **/types/** (type definitions)
# - **/lib/proto/** (generated protobuf)
# - **/lib/data/live-service.ts (requires K8s cluster)
# - **/lib/data/operator-service.ts (requires operator API)
# - **/lib/data/prometheus-service.ts (requires Prometheus)
# - **/lib/data/workspace-api-service.ts (requires backend API)
# - **/lib/k8s/token-fetcher.ts (requires K8s ServiceAccount)
# - **/lib/k8s/workspace-k8s-client-factory.ts (requires K8s cluster)
# - **/lib/k8s/workspace-client.ts (requires K8s cluster)
# - **/lib/image-processor.ts (requires browser Canvas API)
# - **/middleware.ts (Next.js middleware - integration tested)
# - **/components/ui/** (shadcn vendor code)
# - **/lib/mock-data.ts (static test fixtures)
# - **/lib/data/mock-service.ts (demo mode data)
# - **/lib/data/types.ts (type definitions)
# - **/lib/data/provider.tsx (React context wrapper)
#
# Note: hooks/**, components/** (except ui) ARE tested via unit tests.
# Specific API routes excluded because they require K8s/external infrastructure - others have unit tests.
# Auth files excluded because they require NextAuth server infrastructure.
# Arena pages (sources, configs, jobs) are primarily UI composition - business logic tested via hooks.
# License components (license-gate.tsx) are UI gating components - logic tested via hooks.
sonar.coverage.exclusions=**/test/**,**/zz_generated*.go,cmd/main.go,cmd/agent/main.go,cmd/runtime/**,ee/cmd/omnia-arena-controller/main.go,ee/cmd/arena-worker/cmd.go,ee/cmd/arena-worker/worker.go,ee/internal/controller/*.go,ee/internal/webhook/*.go,ee/pkg/license/validator.go,ee/pkg/license/fingerprint.go,internal/session/redis.go,internal/agent/metrics.go,internal/facade/metrics.go,internal/api/*.go,internal/runtime/tracing/tracing.go,internal/runtime/tools_registration.go,internal/runtime/metrics.go,internal/media/s3.go,internal/media/azure.go,internal/media/gcs.go,pkg/arena/queue/*.go,internal/controller/arenasource_controller.go,internal/controller/arenajob_controller.go,internal/controller/workspace_controller.go,**/*.d.ts,**/index.ts,**/index.tsx,**/types/**,**/lib/proto/**,**/lib/data/live-service.ts,**/lib/data/operator-service.ts,**/lib/data/prometheus-service.ts,**/lib/data/workspace-api-service.ts,**/lib/k8s/token-fetcher.ts,**/lib/k8s/workspace-k8s-client-factory.ts,**/lib/k8s/workspace-client.ts,**/lib/image-processor.ts,**/middleware.ts,**/app/api/auth/**,**/app/api/prometheus/**,**/app/api/license/**,**/app/api/workspaces/[name]/agents/**,**/app/api/workspaces/[name]/costs/**,**/app/api/workspaces/[name]/promptpacks/**,**/app/api/workspaces/[name]/providers/**,**/app/api/workspaces/[name]/toolregistries/**,**/app/api/workspaces/[name]/stats/**,**/app/api/workspaces/[name]/route.ts,**/app/api/workspaces/route.ts,**/app/api/providers/**,**/app/api/config/**,**/app/api/health/**,**/app/api/settings/**,**/components/ui/**,**/components/agents/**,**/components/console/**,**/components/cost/**,**/components/credentials/**,**/components/layout/**,**/components/logs/**,**/components/topology/**,**/components/license/**,**/lib/mock-data.ts,**/lib/data/mock-service.ts,**/lib/data/types.ts,**/lib/data/provider.tsx,**/hooks/use-runtime-config.ts,**/lib/auth/actions.ts,**/lib/auth/api-guard.ts,**/lib/auth/config.ts,**/lib/auth/proxy.ts,**/lib/auth/session.ts,**/lib/auth/api-keys/**,**/lib/auth/oauth/**,**/lib/auth/providers/**,**/app/arena/**/page.tsx

# CPD (Copy Paste Detector) exclusions - interface implementations and controller patterns have intentional similarity
# Dashboard OAuth providers have intentional similarity (same interface implementation pattern)
# Tool adapters (HTTP, gRPC, OpenAPI, MCP) follow the same adapter pattern with intentional structural similarity
# Media storage implementations follow Go's idiomatic error handling patterns with intentional structural similarity
# Generated TypeScript types have intentional similarity (CRD interface patterns)
# Split controller/runtime files share patterns from original file
# Queue metrics follow Prometheus metrics patterns with intentional structural similarity
# Queue implementations follow Go interface patterns with intentional structural similarity
# Grafana dashboard panels have intentional structural similarity (stat panels with thresholds)
# Workspace authorization modules have intentional similarity (guard/authz follow same access patterns)
# Workspace API routes follow the same CRD access pattern with intentional structural similarity
# Shared API routes (toolregistries, providers) follow the same shared resource access pattern
# Test files have intentional structural similarity (test patterns, assertions)
# Arena service and mock data follow CRD CRUD patterns with intentional structural similarity
# Arena types follow CRD interface patterns with intentional structural similarity
# Arena app pages (sources, configs, jobs) follow the same intentional list/detail page patterns
# Arena components and hooks follow the same data fetching and UI patterns across CRD types
# EE controllers follow the same patterns as core controllers with intentional structural similarity
sonar.cpd.exclusions=internal/session/redis.go,internal/controller/provider_controller.go,internal/runtime/tools/*_adapter.go,internal/media/*.go,**/lib/auth/oauth/providers/**,**/lib/auth/workspace-*.ts,**/lib/k8s/workspace-*.ts,**/components/ui/**,**/types/generated/**,**/types/workspace.ts,**/types/arena.ts,internal/controller/*.go,internal/runtime/*.go,internal/api/*.go,pkg/arena/queue/*.go,ee/internal/controller/*.go,ee/internal/webhook/*.go,ee/pkg/license/*.go,charts/omnia/templates/grafana-redis-dashboard.yaml,**/app/api/workspaces/**,**/app/api/shared/**,**/lib/data/mock-service.ts,**/lib/data/arena-service.ts,**/*.test.ts,**/*.test.tsx,**/app/arena/**,**/components/arena/**,**/hooks/use-arena-*.ts

# Issue ignore rules (similar to PromptKit)
# e1: Disable TODO comment rule globally - TODOs are tracked in project management
# e2-e3: Disable godre rules globally
# e4: Allow pseudo-random in mock data hooks (used for demo mode visualization)
# e5: Allow pseudo-random in lib/mock-data.ts (test fixtures)
# e6: Allow pseudo-random in mock-service.ts (demo mode data generation)
# e7: Allow HTTP URLs in mock files (not real endpoints, demo data only)
# e8: Allow high cognitive complexity in entry points (initialization code)
# e9: Allow high cognitive complexity in controllers (reconciliation logic)
# e10: Allow high cognitive complexity in API handlers (request processing)
# e11-e12: Allow event handlers on non-interactive containers (event propagation blockers)
# e13: Allow pseudo-random in test files (test data generation)
# e14: Allow any type in test files (mocking flexibility)
# e15: Allow unused expressions in test files (assertions)
# e16: Allow context.Background() in media storage (intentional for background cleanup goroutines)
# e17: Allow temp directory usage in operator entry point (container isolation, not shared /tmp)
# e18: Allow hardcoded IP addresses in workspace controller (RFC 1918 private ranges for NetworkPolicy rules)
sonar.issue.ignore.multicriteria=e1,e2,e3,e4,e5,e6,e7,e8,e9,e10,e11,e12,e13,e14,e15,e16,e17,e18
sonar.issue.ignore.multicriteria.e1.ruleKey=go:S1135
sonar.issue.ignore.multicriteria.e1.resourceKey=**/*.go
sonar.issue.ignore.multicriteria.e2.ruleKey=godre:S1172
sonar.issue.ignore.multicriteria.e2.resourceKey=**/*.go
sonar.issue.ignore.multicriteria.e3.ruleKey=godre:S8148
sonar.issue.ignore.multicriteria.e3.resourceKey=**/*.go
sonar.issue.ignore.multicriteria.e4.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.e4.resourceKey=**/dashboard/src/hooks/**
sonar.issue.ignore.multicriteria.e5.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.e5.resourceKey=**/lib/mock-data.ts
sonar.issue.ignore.multicriteria.e6.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.e6.resourceKey=**/lib/data/mock-service.ts
sonar.issue.ignore.multicriteria.e7.ruleKey=typescript:S5332
sonar.issue.ignore.multicriteria.e7.resourceKey=**/mock*.ts
sonar.issue.ignore.multicriteria.e8.ruleKey=go:S3776
sonar.issue.ignore.multicriteria.e8.resourceKey=cmd/**/main.go
sonar.issue.ignore.multicriteria.e9.ruleKey=go:S3776
sonar.issue.ignore.multicriteria.e9.resourceKey=internal/controller/**
sonar.issue.ignore.multicriteria.e10.ruleKey=go:S3776
sonar.issue.ignore.multicriteria.e10.resourceKey=internal/api/**
sonar.issue.ignore.multicriteria.e11.ruleKey=typescript:S6847
sonar.issue.ignore.multicriteria.e11.resourceKey=**/components/**
sonar.issue.ignore.multicriteria.e12.ruleKey=typescript:S6819
sonar.issue.ignore.multicriteria.e12.resourceKey=**/components/**
sonar.issue.ignore.multicriteria.e13.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.e13.resourceKey=**/*.test.ts
sonar.issue.ignore.multicriteria.e14.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.e14.resourceKey=**/*.test.tsx
sonar.issue.ignore.multicriteria.e15.ruleKey=typescript:S6544
sonar.issue.ignore.multicriteria.e15.resourceKey=**/*.test.*
sonar.issue.ignore.multicriteria.e16.ruleKey=godre:S8239
sonar.issue.ignore.multicriteria.e16.resourceKey=internal/media/*.go
sonar.issue.ignore.multicriteria.e17.ruleKey=go:S5443
sonar.issue.ignore.multicriteria.e17.resourceKey=cmd/main.go
sonar.issue.ignore.multicriteria.e18.ruleKey=go:S1313
sonar.issue.ignore.multicriteria.e18.resourceKey=internal/controller/workspace_controller.go

# Quality gate settings
# Quality gate check is handled by SonarSource/sonarqube-quality-gate-action in CI
# This provides better PR integration with summary comments