name: CI

# This workflow runs for Dependabot PRs only.
# It reports success for jobs that are skipped in ci.yml due to secrets access.
# Dependabot PRs don't have access to SONAR_TOKEN and other secrets.

on:
  pull_request:
    branches: [ main ]
    paths:
      - '**.go'
      - 'go.mod'
      - 'go.sum'
      - 'Dockerfile*'
      - 'api/**'
      - 'cmd/**'
      - 'config/**'
      - 'internal/**'
      - 'pkg/**'
      - 'test/**'
      - 'hack/**'
      - 'dashboard/**'
      - 'sonar-project.properties'
      - '.github/workflows/ci.yml'
      - '.github/workflows/ci-dependabot.yml'

permissions:
  contents: read

jobs:
  # Only run for Dependabot PRs
  sonarcloud:
    name: SonarCloud Analysis
    runs-on: ubuntu-latest
    if: github.actor == 'dependabot[bot]'
    steps:
      - name: Skip - Dependabot PR
        run: echo "Skipping SonarCloud - Dependabot PRs don't have access to SONAR_TOKEN"

  lint:
    name: Lint
    runs-on: ubuntu-latest
    if: github.actor == 'dependabot[bot]'
    steps:
      - name: Skip - Dependabot PR
        run: echo "Skipping lint - Dependabot PRs (security best practice)"

  envtest:
    name: Controller Tests (envtest)
    runs-on: ubuntu-latest
    if: github.actor == 'dependabot[bot]'
    steps:
      - name: Skip - Dependabot PR
        run: echo "Skipping envtest - Dependabot PRs (security best practice)"

  dashboard:
    name: Dashboard
    runs-on: ubuntu-latest
    if: github.actor == 'dependabot[bot]'
    steps:
      - name: Skip - Dependabot PR
        run: echo "Skipping dashboard tests - Dependabot PRs (security best practice)"
